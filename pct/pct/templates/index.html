<%inherit file="master.html"/>
<%namespace name="links" file="links.html"/>
<%def name="title()">FF PCT</%def>
<%def name="page_slogan()">
	<div id="page_slogan"><span class="emphasis">HUHU and welcome to the new and shiny PCT!</span></div>
</%def>
<%def name="headscripts()">
handleResult = function(id, data){
	if(data.success==true){
		dojo.query('#'+id).orphan();
		if(dojo.query('tr.curation_queue_item').length == 0)
			{window.location.reload();}
	} else {
		alert(data.error_data);
	}
}
</%def>

<table class="curation" border="1" cellspacing="20">
<tr><th>Product</th><th>Action</th></tr>
%for cp in c.curation_queue.cp:
	<% 
		pc_id = 'cp_%s' % '_'.join(str(cp.versions[cpv].pc_id) for cpv in cp.versions) 
	%>
	<tr class="curation_queue_item" id="${pc_id}">
	<form action="/index/curate" method="post" id="form_${pc_id}">
	<td class="curation">${display_product(cp.versions)}</td>
	<td class="curation" valign="bottom">
			<textarea style="display:none" name="curation_xml">${cp.xml}</textarea>
			<input type="hidden" name="region" value="${c.curation_queue.region}"/>
			<input type="hidden" id="outcome_${pc_id}" name="outcome" value=""/>
			<input type="button" value="ACCEPT" onclick="dojo.byId('outcome_${pc_id}').value='ACCEPT';xhrFormPost('/index/curate', 'form_${pc_id}', dojo.hitch(null, handleResult, '${pc_id}'))"/>
			<input type="button" value="REJECT" onclick="dojo.byId('outcome_${pc_id}').value='REJECT';xhrFormPost('/index/curate', 'form_${pc_id}', dojo.hitch(null, handleResult, '${pc_id}'))"/>
	</td>
	</form>
	</tr>
%endfor

</table>



<%def name="display_product(cp)">
<%
	versions = sorted(cp, reverse=True)
%>
%if product is not None:
	<table class="curation_product" cellspacing="0" cellpadding="0">
		%for k in c.curation_queue.key_order:
			<tr class="curation_product">
				<td  class="curation_product"><div class="label">${k.replace('_', ' ').title()}:</div></td>
				%for key in versions:
				<td  class="curation_product ${len(set(map(lambda x: getattr(cp[x].product, k), cp))) > 1 and 'different' or 'same'}">
					<div class="property ${k}">${getattr(cp[key].product, k)}</div>
				</td>
				%endfor
			</tr>
		%endfor
		%for k in c.curation_queue.image_keys:
			<tr  class="curation_product">
				<td  class="curation_product"><div class="label">${k}:</div></td>
				%for key in versions:
				<td  class="curation_product ${len(set(map(lambda x: getattr(cp[x].product, k), cp))) > 1 and 'different' or 'same'}">
					<div class="property ${k}"><img src="${getattr(cp[key].product, k)}"/></div>
				</td>
				%endfor
			</tr>
		%endfor
		<tr  class="curation_product">
			<td  class="curation_product"><div class="label">Categories:</div></td>
			%for key in versions:
			<td  class="curation_product">
					%for cat in app_globals.categories.list:
					<input id="category_${cat.name}" type="checkbox" name="category" value="${cat.name}" ${cat.name in cp[key].categories.map and 'checked="checked"' or ''}
							${key=='OLD' and 'disabled="disabled"' or ''}/>
						<label for="category_${cat.name}">${cat.name}</label>
					%endfor
			</td>
			%endfor
		</tr>
	</table>
%else:
	No Product Info
%endif
</%def>