<%!
	import md5
%>
<%namespace name="html" file="../widgets/html_elems.html"/>
<%namespace name="forms" file="../widgets/forms.html"/>


%if c.method == 'facebook':
	${networkinviter("facebook", c.friends, request.merchant.type_is_group_gift)}
%elif c.method == 'twitter':
	${networkinviter("twitter", c.friends, False)}
%elif c.method == 'email':
	${mailinviter()}
%endif

<%def name="networkinviter(network_name, friends, mutuals)">
	<div class="arrowSubTab"></div>
	<div class="boxSearchFriend" id="inviteheader">
		<input type="text" id="filter_${network_name}"  value="Search Friends" _default_text="Search Friends" class="searchFriends default" />
		%if mutuals:
			<span class="mutualToggleContainer"><input id="toggle_mutuals_${network_name}" type="checkbox"/><label for="toggle_mutuals">Mutual Friends</label></span>
		%endif
		<a href="#" class="floatRight inviteAll" id="inviteall_${network_name}">Invite All</a>
	</div>
	 <div class="friendsList">
		<ul id="friend_list_${network_name}" class="${network_name}">
			${render_network_friends(friends, mutuals = mutuals)|n}
		</ul>
	</div>
</%def>

<%def name="render_network_friends(friends, active = True, mutuals = False, show_birthdays = False, add_label = None, rem_label = None)">
%for i,(id, user_data) in enumerate(friends.iteritems()):
	<%
		if "mutual_with" in user_data:
			mutual_class = "mutual"
		elif mutuals:
			mutual_class = "nonmutual hidden"
		else:
			mutual_class = "nonmutual"
	%>
		<li class="invitee_row invite ${active and 'selectable' or 'selected'} ${mutual_class}" id="${user_data['network']}_${id}"
			%if active:
				pos="${i}" ${h.attrib_keys(user_data)|n}
			%endif
		>
			<a class="displayable close" href="#">X</a>
			<div class="avt">
				<img src="${user_data["profile_picture_url"]}">
			</div>
			<p class="hideable">${user_data["name"]}</p>
			<a class="hideable" href="#">Invite &raquo;</a>
			
		</li>
%endfor
</%def>

<%def name="mailinviter()">
	<form action="" method="POST" id="emailinviter">
	<div class="arrowSubTab"></div>
	<div class="firstSpacer floatLeft"><label for="email_networkname" class="fixedWidth">Friend's Name</label><input id="email_networkname" name="invitee.name" type="text" class="" /></div>
	<div class="secondSpacer floatLeft"><label for="email_email" class="fixedWidth">Email</label><input id="email_email" name="invitee.network_id" type="text" class="" />
		<span id="email_inviter_error"></span>
	</div>
	<div class="btnContainer">
		<input type="button" id="emailsubmitter" value="Add to Invitees">
	</div>
	<input type="hidden" name="invitee.network" value="email"/>
	<input type="hidden" name="invitee.notification_method" value="email"/>
	 </form>
</%def>
<%def name="render_email_friends(friends, active = True, class_='selectable', add_label = None, rem_label = None)">
%for i,(id, user_data) in enumerate(friends.items()):
	<li class="invitee_row selectable invite" id="email_${ md5.new(id).hexdigest() }"
			%if active:
				pos="i" ${h.attrib_keys(user_data)|n}
			%endif
	>
		<a class="displayable close" href="#">X</a>
		<div class="avt">
			<img src="${user_data["profile_picture_url"]}">
		</div>
	</li>
	%endfor
</%def>