<%!
	import md5
%>
<%namespace name="html" file="../widgets/html_elems.html"/>
<%namespace name="forms" file="../widgets/forms.html"/>


%if c.method == 'facebook':
	${networkinviter("facebook", c.friends, True)}
%elif c.method == 'twitter':
	${networkinviter("twitter", c.friends, False)}
%elif c.method == 'email':
	${mailinviter()}
%endif

<%def name="networkinviter(network_name, friends, mutuals)">
	<div id="networkinviter_${network_name}">
	<div id="inviteheader" class="${network_name}">
		<input type="text" value="${_("INVITE_PAGE_LABEL_Search friends ...")}" name="fb_filter" id="fb_filter" _default_text="${_("INVITE_PAGE_LABEL_Search friends ...")}" class="default">
	</div>
	<div class="invitepage">
	%if mutuals:
		<div class="mutual_toggle_container">
			<input type="checkbox" id="toggle_mutuals" checked="checked"/>
			<label for="toggle_mutuals">${_("INVITE_PAGE_Only Mutual Friends")}</label>
		</div>
	%endif
	<a class="submitMini" id="inviteall">${_("INVITE_PAGE_LABEL_Invite All")}<span></span></a>

	<div id="friend_list" class="${network_name}">
		${render_network_friends(friends, mutuals = mutuals)|n}
		${render_network_friends(c.already_invited, active=False, mutuals = mutuals)|n}
	</div>
	</div>
	</div>
</%def>



<%def name="render_network_friends(friends, active = True, mutuals = False, show_birthdays = False, add_label = None, rem_label = None)">
%for i,(id, user_data) in enumerate(friends.iteritems()):
	<%
		if "mutual_with" in user_data:
			mutual_class = "mutual"
		elif mutuals:
			mutual_class = "nonmutual hidden"
		else:
			mutual_class = "nonmutual"
	%>
	<div class="invitee_row ${active and 'selectable' or 'selected'} ${mutual_class}" id="${user_data['network']}_${id}"
			%if active:
				pos="${i}" ${h.attrib_keys(user_data)|n}
			%endif
		>
		<img src="${user_data['profile_picture_url']}" class="fbprofilepic" alt="${user_data['name']}"/>
		<span class="label"><b>${user_data['name']}</b>
		%if show_birthdays and 'dob' in user_data:
			<% user_data["dob_fmt"] = h.format_short_date(user_data["dob"]) %>
			<div class="birthdaylabel">${(_("RECEIVER_BIRTHDAY_LABEL_Birthday: %(dob_fmt)s")%user_data)|n}
			%if user_data['dob_difference'] < 60:
				<div>${(_("RECEIVER_BIRTHDAY_LABEL_%(dob_difference)s days to go")%user_data)|n}</div>
			%endif
			</div>
		%endif
		</span>
		%if active:
			<a class="selector invite" title="${user_data['name']}">${add_label or _("INVITE_LABEL_Invite")|n}<span class="selector invite"></span></a>
			<a class="selector remove" title="${user_data['name']}">${rem_label or _("INVITE_LABEL_Remove")|n}<span class="selector remove"></span></a>
		%endif
	</div>
%endfor
</%def>