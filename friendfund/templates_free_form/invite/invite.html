<%! from operator import add %>
<%inherit file="../layout.html"/>
<%namespace name="links" file="../widgets/links.html"/>
<%namespace name="inviter" file="inviter.html"/>

<%def name="scripts()">
	${links.js('friendfund/FriendSelector.js')}
	${links.js('friendfund/InvitePage.js')}
</%def>
<%def name="onloadscripts()">
	parseDefaultsInputs("inviteMessage");
	page = new friendfund.InvitePage({
			container : "inviteContainer",
			invited_node :"invitedContainer",
			method : "${c.method}",
			fb_api_key : "",
			base_url : "${url('invite_index', controller='invite', pool_url=c.pool.p_url)}",
			target_form : "invitees"
		});
	page_reloader = dojo.hitch(null, page.prepareSubmit, page);
	parseSelectables("invitees", "wrapInside");
</%def>

<div class="wrapSubHeader">
  <div class="subHeader">
    <div class="userProfile">
      <div class="nonPoolHeader">
        <div class="prodImgWrap">
          <div class="prodImgSubWrap"> <img src="/static/imgs/dummy/dummy-img-big.jpg" height="90"> </div>
        </div>
        <h2>Step 3. Invite Your Friends To Chip In</h2>
      </div>
      <div class="steps">
        <div class="stepOne"><span>1</span>What are you collecting money for?</div>
        <div class="rightArrow"></div>
        <div class="leftArrow"></div>
        <div class="stepTwo"><span>2</span>Enter pool details</div>
        <div class="rightArrow"></div>
        <div class="leftArrow"></div>
        <div class="stepThree active"><span>3</span>Invite friends to chip in</div>
      </div>
      <div class="clear"></div>
    </div>
  </div>
</div>
<div class="content">
  <div class="colRight moreMarginTop">
  	<a href="#" class="floatRight" id="removeall">Remove All</a>
    <h3>Invited Friends (<span id="invitedCounter">${reduce(add, [0]+[len(c.invitees[invs]) for invs in c.invitees])}</span>)</h3>
		<div class="listSelectedFriends" id="invitedContainer" >
			<p class="inviterTwo ${bool(c.invitees) and "hidden" or ""}">Invite your friends from<br /> the left panel</p>
			<div id="network_invitees" class="invited_list">
				${inviter.render_email_friends(c.invitees.get("email", dict()))}
				${inviter.render_network_friends(c.invitees.get("twitter", dict()))|n}
				${inviter.render_network_friends(c.invitees.get("facebook", dict()))|n}
			</div>
		</div>
  </div>
	<div class="colLeft">
		<div class="invited" id="inviteContainer">
		  <h4>Invite your friends from Facebook, Twitter or Email </h4>
		  
		  <div class="wrapTabs">
			<div class="tabs"> 
				<a href="#" class="methodselector ajaxlink ${c.method == 'facebook' and 'selected' or ''}" _type="facebook">Facebook</a> 
				<a href="#" class="methodselector ajaxlink ${c.method == 'twitter' and 'selected' or ''}" _type="twitter">Twitter</a> 
				<a href="#" class="methodselector ajaxlink ${c.method == 'email' and 'selected' or ''}" _type="email">Email</a> 
			</div>
		  </div>
		  <div class="subTab"  id="inviter"></div>

		  <h4>Add a Personal Message to your Invitees <span>(optional)</span></h4>
		  <form action="${url(controller='invite', pool_url=c.pool_url, action='friends')}" onsubmit="return prepareSubmit()" method="POST" id="invitees">
		  <div style="border:none" class="borderBottom" id="inviteMessage">
      <div class="wrapInside ${('subject' in c.errors) and "error" or ""}">
			<div class="tip">
					<div class="arrow"></div>
				%if 'subject' in c.errors:
					<span>${c.errors['subject']}</span>
				%else:
					<span>Tip goes here Tip goes here Tip goes here Tip goes here Tip goes here Tip goes here</span>
				%endif
			</div>
			<div class="first"> <span>Subject</span> </div>
			<div class="containerTxtArea">
			  <input type="text" class="default" name="subject" _default_text="Write your subject here..." value="${c.values.get("subject", "Write your subject here...")}"/>
			</div>
       </div>
			<div class="padSpacer"></div>
        <div class="wrapInside ${('message' in c.errors) and "error" or ""}">
			<div class="tip">
					<div class="arrow"></div>
				%if 'message' in c.errors:
					<span>${c.errors['message']}</span>
				%else:
					<span>Tip goes here Tip goes here Tip goes here Tip goes here Tip goes here Tip goes here</span>
				%endif
			</div>
			
			<div class="first"> <span>Your message</span> </div>
			<div class="containerTxtArea">
			  <textarea name="message" class="default" _default_text="Write your message here...">${c.values.get("message", "Write your message here...")}</textarea>
			</div>
        </div>
			<p class="info"><a href="#">How will my message be displayed?</a></p>
		  </div>
			<div class="inviteBottom">
			   <div class="spacerPadLeft floatLeft">
					<input type="checkbox" id="check_opt_out" name="opt_out" class="chkbox">
					<label for="check_opt_out">I will invite my friends manually. Please do not send messages on my behalf!</label>
						
							<p>If you are inviting friends manually, here's a link to your pool:</p>
							<input type="text" class="copy" value="${url("get_pool", pool_url = c.pool.p_url, protocol="http")}" onfocus="this.select();"/>
							<p class="bold">Some ways to share this link :</p>
							<ul>
								<li>1.  Copy and paste it into an email</li>
								<li>2.  Copy and paste it in your blog</li>
								<li>3.  Share it in your social networks</li>
								
							</ul>
				</div>
				<div class="wrapInside borderBottom noBorder lessPad">
					<div class="tip">
						<div class="arrow"></div>
						<span>Tip goes here</span> 
					</div>
					<div class="greyInsideFullWidth">
						<div class="first"> <span>&nbsp;</span> </div>
						<input type="checkbox" name="is_secret" id="remainSecretCheckbox" class="chkbox default"/><label for="remainSecretCheckbox">Keep this pool secret</label>
					</div> 
				</div>
				<div class="btnContainer">
				%if len(c.pool.invitees):
					<input type="button" id="invite_submitter" value="Proceed" />
				%else:
					<input type="button" id="invite_submitter" value="Create Pool" />
				%endif
				</div>
			</div>
		</form>
      	</div>
      <div class="clear"></div>
    </div>
  </div>
  <div class="clear"></div>
</div>
