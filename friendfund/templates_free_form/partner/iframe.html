<%inherit file="../master.html"/>
<%namespace name="forms" file="../widgets/forms.html"/>
<%namespace name="links" file="../widgets/links.html"/>
<%namespace name="inviter" file="../invite/inviter.html"/>

<%def name="scripts()">
	${links.js('friendfund/FriendSelector.js')}
	${links.js('friendfund/PartnerPanel.js')}
	${links.js('datepicker.packed.js')}
	${links.css('datepicker.css')}
</%def>
<%def name="onloadscripts()">
	completed = function(){
		return dojo.byId("occasion_name").value && dojo.byId("occasion_date").value && dojo.query(".invitee_row", "network_invitees").length == 1;
	}
	ffp_panel = new friendfund.PartnerPanel({
					container : "receiverSelectorContainer"
					,ref_node : "button_panel_Form"
					,method : "${c.method}"
					,invited_node:"selectedReceiver"
					,mutuals:false
					,base_url:"/myfriends"
					,checkCompleteness:completed
			});

	var fmtDate = "M-sp-d-cc-sp-Y", machineFmtDate = "Y-ds-m-ds-d", intFmtDate = "Y-m-d";
	var today = new Date(), upperEnd = new Date();upperEnd.setDate(upperEnd.getDate() + 45);
	var defaultDateOffset = 14;var defaultDate = new Date(today.getDate() + defaultDateOffset);
	datePickerController.createDatePicker({
	  formElements:{"datepicker":fmtDate},
	  dateFormats:{"datepicker":["Y-sl-m-sl-d", "d-dt-m-dt-Y", "Y-ds-m-ds-d"]},
	  rangeLow:datePickerController.printFormattedDate(today, intFmtDate, false), 
	  rangeHigh:datePickerController.printFormattedDate(upperEnd, intFmtDate, false), 
	  callbackFunctions:{"dateset":[ffp_panel.updateOccasionDate]}
	});
	document.forms.poolCreateForm.onsubmit =  dojo.hitch(ffp_panel, ffp_panel.submit, "${url(controller="partner", action="validate")}");
</%def>


<div id="wrap" style="background:none">
<div class="borderIframe">
	<div class="contentIframe">
		<div class="wrapHeaderIframe">
			<div class="light floatRight">
				<img src="/static/imgs/lightbulb_icon_sml.png" />
				<p>To friendfund a specific product, visit any of 
the product pages on this site.</p>
			</div>
		<div class="colLeftIframe">
			<h3>
				Organise a Group Gift!
			</h3>
			<div class="learnMoreBtn" style="margin-top:15px">
				<span>Help</span>
				<div class="arrowPop hidden"></div>
			</div>
			<div class="helpPopup hidden">
					<a href="#" class="floatRight"> close <span>X</span></a>
					<h4>Quick Guide to Creating a Pool</h4>
					<div class="subHeading"></div>
					<p>Here's how you can create a Group GiftPool and give something extra special without breaking the bank</p>
					<ul>
						<li>
							<span>1.</span>
							<h5>Find a gift</h5>
							<p>What does your recipient really, really want?</p>
						</li>
						<li>
							<span>2.</span>
							<h5>Click the "friendfund it!" button</h5>
							<p>The blue button located on every product page.</p>
						</li>
						<li class="omega">
							<span>3.</span>
							<h5>Choose your recipient</h5>
							<p>from Facebook, Twitter and email friends.</p>
						</li>
						<li>
							<span>4.</span>
							<h5>Choose an occasion..</h5>
							<p>Are you celebrating something special, like a birthday?</p>
						</li>
						<li>
							<span>5.</span>
							<h5>...and contribution deadline</h5>
							<p>Make sure you leave aside plenty of time to purchase your gift</p>
						</li>
						<li class="omega">
							<span>6.</span>
							<h5>Share the cost with friends</h5>
							<p>Invite your friends to chip in as much or as little as they want!</p>
						</li>
					</ul>
					<p class="small">For the Pool to be successful, it needs to reach its target before the expiry date. So tell your friends what the 
Pool is for, they like the idea and contribute. They are only then charged if the Pool gets enough support. If the 
Pool is not successful, no one pays a single penny.</p>
				</div>
			<a class="floatRight" style="margin-top:20px" href="${url("home", host=app_globals.default_host)}"><img src="/static/imgs/powered_by_button.png"/></a>
			<div class="clear"></div>
		</div>
		</div>
		<div class="wrapContentIframe">
			<form name="poolCreateForm" method="POST" id="button_panel_Form">
			<div class="floatRight colRightIframe">
			  <div class="bgDark">
				<div id="productArea">
					%for p in c.product_list:
						<div id="product_${p.guid}" class="${p.guid != c.product.guid and "hidden" or "selectedProduct"}">
							<h5>Your gift:</h5>
							<div class="boxWhat">
								<div class="prod">
									<img width="250px" class="prodPicture" src="${p.get_picture("FF_POOLS")}"/>
								</div>
								<p class="title"><a href="#">${p.get_display_label(words = 10)}</a></p>
								<div class="clear"></div>
							</div>	
						</div>
					%endfor
					%if len(c.product_list)>1:
						<h6>Edit</h6>
						<select id="productSelector" name="productMap">
							%for p in c.product_list:
							<option ${forms.expression_quote(c.product.guid == p.guid, "selected")|n} value="${p.to_minimal_repr()}" _guid="${p.guid}">
								${p.get_display_label(words = 10)}
							</option>
							%endfor
						</select>
					%else:
						<input type="hidden" name="productMap" value="${c.product.to_minimal_repr()}"/>
					%endif
				</div>
				<div class="generalBoxIframe" style="height:90px">
					<h5>Recipient</h5>
					<div id="selectedReceiver" class="floatLeft listSelectedFriends boxWhat">
					<ul id="network_invitees" class="invited_list">
					<% receiver_data = getattr(c, "receiver_data", None) %>
					%if receiver_data:
						<% receiver_mockup = {receiver_data.get("network_id"):receiver_data} %>
						${inviter.render_network_friends(receiver_mockup)|n}
					%endif
					</ul>
		
					</div>
					<div class="errorMsgIframe hidden" style="margin-top:10px">Please choose your recipient from the left panel.</div>
					<div class="clear"></div>
				</div>
				<div id="selectedOccasion">
					<div class="generalBoxIframe">
						<label>Occasion: </label><input type="text" name="occasion_name" id="occasion_name" value="${c.values.get("occasion_name")}" />
						<div class="errorMsgIframe hidden">Please choose your recipient from the left panel.</div>
					</div>
					<div class="generalBoxIframe">
						<label>Contribution Deadline: </label><input type="text" name="date" id="occasion_date" value="${c.values.get("date")}" style="width:70px" />
						<div class="errorMsgIframe hidden">Please choose your recipient from the left panel.</div>
					</div>
					<input type="hidden" name="occasion_key" id="occasion_key" value="${c.values.get("occasion_key","EVENT_OTHER")}" />
				</div>
				
				<input type="submit" value="Invite Friends" class="floatRight"/>
				
				<span  class="forward floatRight" style="margin-top:20px"><span class="floatRight"><input type="button" value="&gt;">Invite Friends</span> </span>
				
				
				
				<div class="clear"></div>
			    </div>
			  </div>
			</form>
		<div class="colLeftIframe floatLeft">
			<div id="receiverSelectorContainer" class="floatLeft">
				<h4 class="error">Choose Your recipient</h4>
				<div class="subHeading"></div>
				<div class="wrapTabs">
					<div class="tabs"> 
						<span class="methodselector ajaxlink ${c.method == 'facebook' and 'selected' or ''}" _type="facebook">Facebook</span> 
						<span class="methodselector ajaxlink ${c.method == 'twitter' and 'selected' or ''}" _type="twitter">Twitter</span> 
						<span class="methodselector ajaxlink ${c.method == 'email' and 'selected' or ''}" _type="email">Email</span> 
					</div>
				</div>
				<div class="subTab" id="inviter"></div>
			</div>
			
			
		
			<div id="occasionSelectorContainer" class="error floatLeft">
			
				<div class="occasionLabel first">${_("EVENT_PANEL_Choose an occasion:")}</div>
				<select id="occasionSelector" _name_target="occasion_name" _key_target="occasion_key">
					%for occ in c.olist:
						<option custom="${int(occ.custom or 0)}" key="${occ.key}" displayname="${occ.get_display_name()}" date="${occ.internal_date_format}" 
								${forms.expression_quote(c.values.get("occasion_key")== occ.key, "selected")|n}>
							%if occ.custom:
								${_("EVENT_PANEL_Just because...")}
							%else:
								${occ.get_display_name()}
							%endif
						</option>
					%endfor
				</select>
		</div>
		<div id="yourOccasionSelector" class="error floatLeft">
				<div class="occasionLabel first">... or enter your own occasion</div>

				<input type="text" id="occasionTyper" _target="occasion_name" custom="1" key="EVENT_OTHER" />
		</div>
		<div id="contributionDeadline" class="error floatLeft">
				<div class="occasionLabel first">Contribution Deadline</div>
				<input class="small" readonly="readonly" type="text" id="datepicker" value=""/>
		</div>
			<div class="footerColSx">
			<div class="colRightWhite"></div>
				<div class="floatLeft">
					<span class="floatLeft">As seen in:</span>
					<div><img src="/static/imgs/Deutsche_Startups_sml.png" /></div>
					<div><img src="/static/imgs/Zanox_sml.png" /></div>
					<div><img src="/static/imgs/IWB_sml.png" /></div>
				</div>
				<div class="floatRight">
					<span>You are safe with us</span>
					<div class="floatRight" style="margin-top:0"><img src="/static/imgs/veri-sign.png" /></div>
				</div>
				<div class="clear"></div>
			</div>
			</div>
			
			<div class="clear"></div>
			</div>
		<div class="clear"></div>
		</div>
	</div>
</div>
</div>
<%def name="user_voice()"></%def>