<%inherit file="../master.html"/>
<%namespace name="forms" file="../widgets/forms.html"/>
<%namespace name="links" file="../widgets/links.html"/>
<%namespace name="inviter" file="../invite/inviter.html"/>
<%def name="scripts()">
	${links.js('friendfund/FriendSelector.js')}
	${links.js('friendfund/PartnerPanel.js')}
	${links.js('datepicker.packed.js')}
	${links.css('datepicker.css')}
	<script type="text/javascript">
	dojo.query(".helpPopupToggler", "helpPopupContainer").onclick(
		function(evt){
			dojo.query(".helpPopupHook","helpPopupContainer").toggleClass("hidden");
		}
	);
	</script>
</%def>
<%def name="onloadscripts()">
	ffp_panel = new friendfund.PartnerPanel({
					container : "receiverSelectorContainer"
					,target_form : "button_panel_Form"
					,method : "${c.method}"
					,invited_node:"selectedReceiver"
					,mutuals:false
					,base_url:"/myfriends"
			});
	window.pageState.sbmt = dojo.hitch(ffp_panel, ffp_panel.submit, "${url(controller="partner", action="validate")}", 9);
	document.forms.poolCreateForm.onsubmit = function(){return window.pageState.sbmt()};
	fbLogout = function(){
	FB.getLoginStatus(function(response){
		if(response.session){
			FB.logout(function(response){xhrPost("/logout?furl=/");window.parent.FriendFund.Popin.show(window.parent.friendfundOptions);});
		} else {
			xhrPost("/logout?furl=/");
			window.parent.FriendFund.Popin.show(window.parent.friendfundOptions);
		}
	});
	};
</%def>


<div id="wrap" style="background:none">
<div class="borderIframe">
	<div class="contentIframe">
		<div class="wrapHeaderIframe">
			%if getattr(c,"is_default", False):
			<div class="light floatRight">
				<img src="/static/imgs/lightbulb_icon_sml.png" />
				<p><b>${_("FF_IFRAME_To friendfund a specific product, visit any of the product pages on this site.")}</b></p>
			</div>
			%endif
		<div class="colLeftIframe" id="helpPopupContainer">
			<img class="floatLeft merchantLogo" style="margin:7px 0 0 50px" width="90px" height="45px" src="${request.merchant.get_logo_url("med")}"/>
			<h3>${_("FF_IFRAME_Organise a Group Gift!")}</h3>
			<div class="popupBackground dark helpPopupToggler helpPopupHook ${not c.user.is_anon and "hidden" or ""}" style="z-index:1000;"></div>
			<div class="learnMoreBtn">
				<span class="helpPopupToggler">${_("FF_IFRAME_BUTTON_Help")}</span>
				<div class="arrowPop helpPopupHook ${not c.user.is_anon and "hidden" or ""}"></div>
			</div>
			<div class="helpPopup helpPopupHook ${not c.user.is_anon and "hidden" or ""}" style="z-index:1001;">
					<a href="#" class="helpPopupToggler floatRight close"> ${_("FF_close")} <span>X</span></a>
					<h4>${_("FF_IFRAME_Quick Guide to Creating a Pool")}</h4>
					<div class="subHeading"></div>
					<p>${_("FF_IFRAME_Create a Group Gift Pool and give something extra special without breaking the bank.")}</p>
					<ul>
						<li>
							<div class="arrowSubTab"></div>
							<div>
								<div>
									<img src="/static/imgs/iframe-partner/gift_icon.png" />
								</div>
							
							</div>
							<div class="colRightWhite"></div>
							<h5>${_("FF_IFRAME_Find a gift and click the friendfund it! button ")}</h5>
							<p>${_("FF_IFRAME_Find the perfect gift from our huge selection. ?")}</p>
							
						</li>
						<li>
							<div class="arrowSubTab"></div>
							<div>
								<div>
									<img src="/static/imgs/iframe-partner/recipient_icon.png" />
								</div>
							</div>
							<div class="colRightWhite"></div>
							<h5>${_("FF_IFRAME_Choose your recipient, occasion and contribution deadline")}</h5>
							<p>${_("FF_IFRAME_Select your friend and special occasion. Make sure to leave aside plenty of time when selecting a deadline.")}</p>
							
						</li>
						<li class="omega">
							<div>
								<div>
									<img src="/static/imgs/iframe-partner/friends_icon.png" />
								</div>
							</div>
							<div class="colRightWhite"></div>
							<h5>${_("FF_IFRAME_Share the costs with  friends!")}</h5>
							<p>${_("FF_IFRAME_Invite your friends to chip in as much or as little as they want!")}</p>
							
						</li>
					
					</ul>
					<a class="forward floatRight helpPopupToggler" style="margin-top:13px" href="#">${_("FF_IFRAME_HELPPOPUP_Get started")}</a>
					
				</div>
			<div class="clear"></div>
		</div>
		</div>
		
		
		<div class="wrapContentIframe">
			<form name="poolCreateForm" method="POST" id="button_panel_Form">
			<div class="floatRight colRightIframe">
				<div class="bgDark">
					<div id="productArea">
						%for p in c.product_list:
							<div id="product_${p.guid}" class="${p.guid != c.product.guid and "hidden" or "selectedProduct"}">
								<h5>${_("FF_IFRAME_Your gift:")}</h5>
								<div class="boxWhat">
									<div class="prod">
										<img class="prodPicture" src="${p.get_picture("FF_POOLS")}"/>
									</div>
									<p class="title"><a target="_blank" href="${p.tracking_link}">${p.get_display_label(words = 10)}</a></p>
									<div class="clear"></div>
								</div>	
							</div>
						%endfor
						%if len(c.product_list)>1:
							<h6>${_("FF_IFRAME_Edit")}</h6>
							<select id="productSelector" name="productMap">
								%for p in c.product_list:
								<option ${forms.expression_quote(c.product.guid == p.guid, "selected")|n} value="${p.to_minimal_repr()}" _guid="${p.guid}">
									${p.get_display_label(words = 10)}
								</option>
								%endfor
							</select>
						%else:
							<input type="hidden" name="productMap" value="${c.product.to_minimal_repr()}"/>
						%endif
					</div>
					<div class="generalBoxIframe" style="height:90px" id="selectedReceiverContainer">
						<h5>${_("FF_IFRAME_Recipient")}</h5>
						
						<div id="selectedReceiver" class="floatLeft listSelectedFriends boxWhat">
							<ul id="network_invitees" class="invited_list">
							<% receiver_data = getattr(c, "receiver_data", None) %>
							%if receiver_data:
								<% receiver_mockup = {receiver_data.get("network_id"):receiver_data} %>
								${inviter.render_network_friends(receiver_mockup, var_show_name= False)|n}
							%endif
							</ul>
						</div>
						<div class="errorMsgIframe large hidden" style="margin-top:10px">${_("FF_IFRAME_Please choose your recipient from the left panel.")}</div>
						<div class="clear"></div>
					</div>
					<div id="selectedOccasion">
						<div class="generalBoxIframe">
							<label>${_("FF_IFRAME_Occasion:")}</label> <input type="text" name="occasion_name" id="occasion_name" value="${c.values.get("occasion_name")}" readonly="readonly" />
							<div class="errorMsgIframe hidden">${_("FF_IFRAME_Please choose an occasion from the left panel.")}</div>
						</div>
						<div class="generalBoxIframe">
							<label>${_("FF_IFRAME_Contribution Deadline:")}</label> <input type="text" name="date" id="occasion_date" value="${c.values.get("date")}" style="width:70px" readonly="readonly" />
							<div class="errorMsgIframe hidden">${_("FF_IFRAME_Please choose a deadline from the left panel.")}</div>
						</div>
						<input type="hidden" name="occasion_key" id="occasion_key" value="${c.values.get("occasion_key","EVENT_OTHER")}" readonly="readonly" />
					</div>
					<input class="forward floatRight" style="margin-top:20px" type="submit" value="${_("FF_IFRAME_Invite Friends")}"/>
					<div class="clear"></div>
				</div>
			</div>
			</form>
		<div class="colLeftIframe floatLeft">
			<div id="receiverSelectorContainer" class="floatLeft">
				<h4 class="errorHook">${_("FF_IFRAME_Choose Your recipient")}</h4>
				<div class="subHeading"></div>
				<div class="wrapTabs">
					<div class="tabs"> 
						<span class="methodselector ajaxlink ${c.method == 'facebook' and 'selected' or ''}" _type="facebook">Facebook</span> 
						<span class="methodselector ajaxlink ${c.method == 'twitter' and 'selected' or ''}" _type="twitter">Twitter</span> 
						<span class="methodselector ajaxlink ${c.method == 'email' and 'selected' or ''}" _type="email">Email</span> 
					</div>
				</div>
				<div class="subTab" id="inviter"></div>
			</div>
			
			
		
			<div id="occasionSelectorContainer" class="errorHook floatLeft">
				<div class="occasionLabel first">${_("FF_IFRAME_Choose an occasion:")}</div>
				<select id="occasionSelector" _name_target="occasion_name" _key_target="occasion_key">
					%for occ in c.olist:
						<option custom="${int(occ.custom or 0)}" key="${occ.key}" displayname="${occ.get_display_name()}" date="${occ.internal_date_format}" 
								${forms.expression_quote(c.values.get("occasion_key")== occ.key, "selected")|n}>
							%if occ.custom:
								${_("FF_IFRAME_Just because...")}
							%else:
								${occ.get_display_name()}
							%endif
						</option>
					%endfor
				</select>
		</div>
		<div id="yourOccasionSelector" class="errorHook floatLeft">
				<div class="occasionLabel first">${_("FF_IFRAME_... or enter your own occasion")}</div>
				<input type="text" id="occasionTyper" _target="occasion_name" custom="1" key="EVENT_OTHER" />
		</div>
		<div id="contributionDeadline" class="errorHook floatLeft">
				<div class="occasionLabel first">${_("FF_IFRAME_Contribution Deadline")}</div>
				<input class="small" readonly="readonly" type="text" id="datepicker" value=""/>
		</div>
			<div class="footerColSx">
			<div class="colRightWhite"></div>
				<div class="floatLeft">
					<div><a target="_blank" href="${url("home", host=app_globals.default_host)}"><img src="/static/imgs/powered_by_button_long.png"/></a></div>
				</div>
				<div class="floatRight">
					<span>${_("FF_IFRAME_You are safe with us")}</span>
					<div class="floatRight" style="margin-top:0"><img width="58px;" src="/static/imgs/veri-sign.png" /></div>
				</div>
				<div class="clear"></div>
			</div>
			</div>
			
			<div class="clear"></div>
			</div>
		<div class="clear"></div>
		</div>
	</div>
</div>
<%def name="user_voice()"></%def>