<%inherit file="../master.html"/>
<%namespace name="forms" file="../widgets/forms.html"/>
<%namespace name="links" file="../widgets/links.html"/>
<%namespace name="inviter" file="../invite/inviter.html"/>

<%def name="scripts()">
	${links.js('friendfund/FriendSelector.js')}
	${links.js('friendfund/PartnerPanel.js')}
	${links.js('datepicker.packed.js')}
	${links.css('datepicker.css')}
</%def>
<%def name="onloadscripts()">
	ffp_panel = new friendfund.PartnerPanel({
					container : "receiverSelectorContainer"
					,ref_node : "button_panel_Form"
					,method : "${c.method}"
					,invited_node:"selectedReceiver"
					,mutuals:false
					,base_url:"/myfriends"
			});

	var fmtDate = "M-sp-d-cc-sp-Y", machineFmtDate = "Y-ds-m-ds-d", intFmtDate = "Y-m-d";
	var today = new Date(), upperEnd = new Date();upperEnd.setDate(upperEnd.getDate() + 45);
	var defaultDateOffset = 14;var defaultDate = new Date(today.getDate() + defaultDateOffset);
	datePickerController.createDatePicker({
	  formElements:{"datepicker":fmtDate},
	  dateFormats:{"datepicker":["Y-sl-m-sl-d", "d-dt-m-dt-Y", "Y-ds-m-ds-d"]},
	  rangeLow:datePickerController.printFormattedDate(today, intFmtDate, false), 
	  rangeHigh:datePickerController.printFormattedDate(upperEnd, intFmtDate, false), 
	  callbackFunctions:{"dateset":[ffp_panel.updateOccasionDate]}
	});
	submitter = function(){ffp_panel.submit('${url('pool_create')}');}
</%def>


<div id="wrap" style="background:none">
<div class="borderIframe">
	<div class="contentIframe">
		<div class="wrapHeaderIframe">
			<div class="light floatRight">
				<img src="/static/imgs/lightbulb_icon_sml.png" />
				<p>To friendfund a specific product, visit any of 
the product pages on this site.</p>
			</div>
			<h3>
				Organise a Group Gift!
			</h3>
			<span class="learnMoreBtn" style="margin-top:15px">Help</span>
			<a class="floatLeft" style="margin-top:0px" href="${url("home", host=app_globals.default_host)}"><img src="/static/imgs/powered_by_button.png"/></a>
			<div class="clear"></div>
		</div>
		<div class="wrapContentIframe">
			<form action="javascript:window.submitter(this)" name="poolCreateForm" method="POST" target="_parent" id="button_panel_Form">
			<script type="text/javascript">
				console.log(window);
				console.log(window.submitter);
				console.log(document);
			</script>
			
			<div class="floatRight colRightIframe">
			  <div class="bgDark">
				<div id="productArea">
					%for p in c.product_list:
						<div id="product_${p.guid}" class="${p.guid != c.product.guid and "hidden" or "selectedProduct"}">
							<h5>Your gift:</h5>
							<div class="boxWhat">
								<div class="prod">
									<img width="250px" class="prodPicture" src="${p.get_picture("FF_POOLS")}"/>
								</div>
								<p class="title"><a href="#">${p.get_display_label(words = 10)}</a></p>
								<div class="clear"></div>
							</div>	
						</div>
					%endfor
					%if len(c.product_list)>1:
						<h6>Edit</h6>
						<select id="productSelector" name="productMap">
							%for p in c.product_list:
							<option ${forms.expression_quote(c.product.guid == p.guid, "selected")|n} value="${p.to_minimal_repr()}" _guid="${p.guid}">
								${p.get_display_label(words = 10)}
							</option>
							%endfor
						</select>
					%endif
				</div>
				<div id="selectedReceiver" class="floatRight listSelectedFriends">
					<div id="network_invitees" class="invited_list">
	
					</div>
				</div>
				
				<div id="selectedOccasion" class="floatRight clear">
					<div>So you selected:</div>
					<input type="text" name="occasion_name" id="occasion_name" value="" />
					<input type="text" name="occasion_date" id="occasion_date" value="" />
				</div>
				
				<input type="submit" value="submit" class="floatRight"/>
				<div class="clear"></div>
			    </div>
			  </div>
			</form>
		<div class="colLeftIframe floatLeft">
			<div id="receiverSelectorContainer" class="floatLeft">
				<h4>Choose Your recipient</h4>
				<div class="subHeading"></div>
				<div class="wrapTabs">
					<div class="tabs"> 
						<span class="methodselector ajaxlink ${c.method == 'facebook' and 'selected' or ''}" _type="facebook">Facebook</span> 
						<span class="methodselector ajaxlink ${c.method == 'twitter' and 'selected' or ''}" _type="twitter">Twitter</span> 
						<span class="methodselector ajaxlink ${c.method == 'email' and 'selected' or ''}" _type="email">Email</span> 
					</div>
				</div>
				<div class="subTab" id="inviter" style="width:520px;clear: left;"></div>
			</div>
			
			
		
			<div id="occasionSelectorContainer" class="floatLeft">
				<div class="occasionLabel first">${_("EVENT_PANEL_Choose an occasion:")}</div>
				<select id="occasionSelector"  _target="occasion_name">
					%for occ in c.olist:
						<option custom="${int(occ.custom or 0)}" key="${occ.key}" displayname="${occ.get_display_name()}" date="${occ.internal_date_format}">
							%if occ.custom:
								${_("EVENT_PANEL_Just because...")}
							%else:
								${occ.get_display_name()}
							%endif
						</option>
					%endfor
				</select>
		</div>
		<div id="yourOccasionSelector">
				<div class="occasionLabel first">... or enter your own occasion</div>

				<input type="text" id="occasionTyper" _target="occasion_name" custom="1" key="EVENT_OTHER" />
		</div>
		<div id="contributionDeadline">
				<div class="occasionLabel first">Contribution Deadline</div>
				<input class="small" readonly="readonly" type="text" id="datepicker" value=""/>
		</div>
			<div class="footerColSx">
				<div class="floatLeft">
					<span class="floatLeft">As seen in:</span>
					<div><img src="/static/imgs/Deutsche_Startups_sml.png" /></div>
					<div><img src="/static/imgs/Zanox_sml.png" /></div>
					<div><img src="/static/imgs/IWB_sml.png" /></div>
				</div>
				<div class="floatRight">
					<span>You are safe with us</span>
					<div class="floatRight"><img src="/static/imgs/veri-sign.png" /></div>
				</div>
				<div class="clear"></div>
			</div>
			</div>
			
			<div class="clear"></div>
			</div>
		<div class="clear"></div>
		</div>
	</div>
</div>
</div>
<%def name="user_voice()"></%def>