<%inherit file="../layout.html"/>
<%namespace name="widgets" file="../widgets/widgets.html"/>
<%namespace name="links" file="../widgets/links.html"/>

<%def name="title()">Chipin to ${c.pool.title}</%def>

<%def name="onloadscripts()">
	parseDefaultsInputs("creditcardForm");
	parseSelectables("creditcardForm");
	dojo.query("#creditcardForm").onsubmit(
		function(evt){
			dojo.query("input[type=submit]", evt.target).forEach(function(elem){
				var parent = elem.parentNode;
				dojo.empty(parent);
				parent.appendChild(dojo.create("IMG", {src:"${links.ajax_loading_src()}"}));
			});
		
		});
	dojo.query(".popuplink", "creditcardForm").onclick(dojo.hitch(null, loadPopup));
</%def>

<div class="wrapSubHeader">${self.renderMessages(c.pool.p_url)|n}
  <div class="subHeader">
    <div class="userProfile">
      <div class="nonPoolHeader">
        <div class="prodImgWrap">
          <div class="prodImgSubWrap"> <img src="${c.pool.get_product_display_picture("FF_POOL_PIC_S")}" height="50px" width="60px"> </div>
        </div>
        <h2>${_("FF_CONTRIB_DETAILS_HEADER_Last Step: Your Payment Details")}</h2>
      </div>
      <div class="steps">
        <div class="stepOne"><span>1</span>${_("FF_CONTRIB_PAGE_HEADER_Chip in")}</div>
        <div class="rightArrow"></div>
        <div class="leftArrow active"></div>
        <div class="stepTwo active"><span>2</span>${_("FF_CONTRIB_PAGE_HEADER_Payment info")}</div>
        <div class="rightArrow active"></div>
        <div class="leftArrow "></div>
        <div class="stepThree"><span>3</span>${_("FF_CONTRIB_PAGE_HEADER_Done!")}</div>
      </div>
      <div class="clear"></div>
    </div>
  </div>
</div>

<div class="content">
	<div class="colRight"></div>
	<div class="colLeft">
	<form action="${url(controller="payment", action="creditcard", pool_url=c.pool.p_url, protocol=app_globals.SSL_PROTOCOL)}" id="creditcardForm" method="POST">
		<input type="hidden" name="creditcard.ccType" value="${c.payment_method.code}"/>
		<input type="hidden" name="token" value="${c.form_secret}"/>
		<div class="poolDets">
			<h4>${_("FF_CONTRIB_DETAILS_Confirm Your Contribution")}</h4>
			<div class="borderBottom noBorder">
				<div class="first" style="margin-top:8px">${_("FF_CONTRIB_DETAILS_Your contribution")}</div>
				<div class="greyInside " style="width:516px">
				<span class="value">${h.display_currency(c.pool.currency)}</span> 
					<p class="editableAmount bold">${h.format_number(c.values.get("amount"))}</p>
					
				
				<span class="darkGrey floatRight">${_("FF_CONTRIB_PAGE_MAX. CONTRIBUTION: ")}<span class="bold"> ${h.format_currency(c.pool.get_amount_left(), c.pool.currency)}</span></span>
				
			</div>
			</div>
			<!--<a href="#" class="editContrib">Edit</a>-->
		<% locals = {"expiry_date":h.format_date(c.pool.expiry_date, format="full"),"admin_name":c.pool.admin.name} %>
		</div>
		<div class="contentDetails">
        <div class="imgSpacer"> 
				
                <div id="verisign_contrib" class="floatRight" style="margin-left:20px">
					<table width="135" border="0" cellpadding="2" cellspacing="0" title="Click to Verify - This site chose VeriSign SSL for secure e-commerce and confidential communications.">
					<tr>
					<td width="135" align="center" valign="top">
						<script type="text/javascript" src="https://seal.verisign.com/getseal?host_name=www.friendfund.com&amp;size=S&amp;use_flash=NO&amp;use_transparent=NO&amp;lang=en"></script><br />
						<a href="http://www.verisign.com/ssl-certificate/" target="_blank"  style="color:#000000; text-decoration:none; font:bold 7px verdana,sans-serif; letter-spacing:.5px; text-align:center; margin:0px; padding:0px;">ABOUT SSL CERTIFICATES</a>
					</td>
					</tr>
					</table>
				</div>
			</div>
		${_("FF_CONTRIB_PAGE_You won&#39;t be charged anything unless this Pool is fully funded by %(expiry_date)s. If it isn't funded in time, no one pays a single penny.")%locals}
		####<a class="popuplink" _href="${url(controller="content", action="pledging_faq")}">${_("FF_CONTRIB_PAGE_Learn More")} »</a>
		</div>
        
		<div class="clear"></div>
	<h4>${_("FF_CONTRIB_DETAILS_Pay by CreditCard")}</h4>
    <div class="borderBottom ">
    
     <div class="first">Card type</div><img src="/static/imgs/${c.payment_method.code}_color.png" style="margin-top:3px">
     </div>
		<div class="borderBottom  ${('ccHolder' in c.errors) and "error" or ""}">
			<div class="tip">
				<div class="arrow"></div>
			%if "ccHolder" in c.errors:
				<span>${c.errors.get("ccHolder")}</span>
			%else:
				<span>${_("FF_CONTRIB_DETAILS_Holder Tip goes here")}</span>
			%endif
			</div>
			<div class="greyInsideFullWidth">
				<div class="first">
					<span>${_("FF_CONTRIB_DETAILS_Cardholder's Name")}</span>
				</div>
				<input type="text" name="creditcard.ccHolder" value="${c.values.get("ccHolder")}"/>
			</div>
		</div>
		<div class="borderBottom  ${('ccNumber' in c.errors) and "error" or ""}">
			<div class="tip">
				<div class="arrow"></div>
			%if "ccNumber" in c.errors:
				<span>${c.errors.get("ccNumber")}</span>
			%else:
				<span>${_("FF_CONTRIB_DETAILS_ccNumber Tip goes here")}</span>
			%endif
			</div>
			<div class="greyInsideFullWidth">
				<div  class="first">
					<span>${_("FF_CONTRIB_DETAILS_Card Number")}</span>
				</div>
				<input type="text"  name="creditcard.ccNumber" value="${c.values.get("ccNumber")}"/>
			</div>
		</div>
		<div class="borderBottom  ${h.contains_one(["ccExpiresMonth", "ccExpiresYear"], c.errors) and "error" or ""}">
			<div class="tip">
				<div class="arrow"></div>
			%if h.contains_one(["ccExpiresMonth", "ccExpiresYear"], c.errors):
				<span>
					<ul>
						%if 'ccExpiresMonth' in c.errors:
							<li>${c.errors.get("ccExpiresMonth")}</li>
						%endif
						%if 'ccExpiresYear' in c.errors:
							<li>${c.errors.get("ccExpiresYear")}</li>
						%endif
					</ul>
				</span>
			%else:
				<span>${_("FF_CONTRIB_DETAILS_ccExpiryDate Tip goes here")}</span>
			%endif
			</div>
			<div class="greyInsideFullWidth">
				<div class="first">
					<span>${_("FF_CONTRIB_DETAILS_Expiry Date")}</span>
				</div>
				<select name="creditcard.ccExpiresMonth" class="smallForm">
				%for key,val in c.payment_method.cc_validity_months:
					<option ${widgets.input_selected("ccExpiresMonth", key)} value="${key}">${val}</option>
				%endfor
				</select>
				<select name="creditcard.ccExpiresYear" class="smallForm">
				%for key,val in c.payment_method.cc_validity_years:
					<option ${widgets.input_selected("ccExpiresYear", key)} value="${key}">${val}</option>
				%endfor
				</select>
			</div>
		</div>
		<div class="borderBottom  ${('ccCode' in c.errors) and "error" or ""}" style="border-bottom:none">
			<div class="tip">
				<div class="arrow"></div>
			%if "ccCode" in c.errors:
					<span>${c.errors.get("ccCode")}</span>
			%else:
				<span>${_("FF_CONTRIB_DETAILS_ccSecurityCode Tip goes here")}</span>
			%endif
			</div>
			<div class="greyInsideFullWidth">
				<div  class="first">
					<span>${_("FF_CONTRIB_DETAILS_Card Validation Code")}</span>
				</div>
				<input type="text" name="creditcard.ccCode" value="${c.values.get("ccCode")}" class="smallForm" style="width:40px !important" />
					<a class="smallForm popuplink" _href="${url(controller="content", action="what_is_cvc")}">${_("FF_CONTRIB_DETAILS_what's this?")} »</a>
			</div>
		</div>
        <div class=" floatRight spacerButtons">
		<input type="submit" value="${_("FF_CONTRIB_DETAILS_Submit")}" class="primaryButton floatRight"/>
        </div>
	</div>
	</form>
    <div class="clear"></div> 
</div>

