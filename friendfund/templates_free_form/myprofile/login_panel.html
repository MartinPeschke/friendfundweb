<%def name="renderPanel()">
		<form id="login_panel_form">
			<div class="inputline">
				<label for="login_email">Email Address</label>
				<input type="text" value="${getattr(c, "login_values", dict()).get("email")}" name="login.email" id="login_email"/>
				%if "email" in getattr(c, "login_errors", dict()):
					<p class="error">${getattr(c, "login_errors", dict()).get("email")}</p>
				%endif
			</div>
			<div class="inputline">
				<label for="login_pwd">Password</label>
				<input type="password" value="${getattr(c, "login_values", dict()).get("pwd")}" name="login.pwd" id="login_pwd"/>
				%if "pwd" in getattr(c, "login_errors", dict()):
					<p class="error">${getattr(c, "login_errors", dict()).get("pwd")}</p>
				%endif
			<div>
				<a href="/myprofile/password" class="lostpass">Forgot Password?</a></div>
			</div>
		</form>
		<a onclick="xhrFormPost('${url(controller='myprofile', action='loginpanel')}', 'login_panel_form', place_element(dojo.byId('loginPanelContent')))" class="primaryButton floatLeft" style="margin-top:7px">Log In</a>
		<h3>Login with facebook or twitter</h3>
		<div class="inputline">
			<a title="Log in with Facebook" class="facebookBtn" onclick="fbLogin()">
				<span>Log in with Facebook</span>
			</a>
		</div><div class="inputline">
		<a title="Log in with Twitter" class="twitterBtn" onclick="twInit('/')">
			<span>Log in with Twitter</span>
		</a>
		</div>
		<p>Dont have an account yet? <a class="lostpass" href="/signup?furl=/">Sign up here</a></p>
</%def>


%if c.user.is_anon:
	<div class="newFormControls loginPanel ${not getattr(c, "expanded", False) and "hidden" or ""}" id="loginPanelContent">
		${renderPanel()|n}
	</div>
	<a class="btn" id="loginlink" onclick="toggleLoginPanel(this)">Login</a>
	<a href="/signup?furl=/" class="btn">Sign Up</a>
	
	<script type="text/javascript">
	closeLoginPanel = function(evt){
		if(dojo.hasClass("loginlink", "active")){
			dojo.removeClass("loginlink", "active");
			dojo.addClass("loginPanelContent", "hidden");
		}   
	}
	toggleLoginPanel = function(link){
		if(dojo.hasClass(link, "active")){
			dojo.removeClass(link, "active");
			dojo.addClass("loginPanelContent", "hidden");
		} else {
			dojo.addClass(link, "active");
			dojo.removeClass("loginPanelContent", "hidden");
		}
	}
	document.onkeydown = function(evt){if(evt.keyCode == 27){closeLoginPanel(evt);}};
	document.onclick = function(evt){if(evt.target.id!="loginlink"&&!findParent(evt.target, "loginPanel")){closeLoginPanel(evt);}};
	</script>
%else:
	<img src="${c.user.get_profile_pic()}" width="25px" height="25px" />
	<div class="showHide">
		<a href="#">${c.user.name or c.user.default_email}</a>
		<div class="widthGiver">
			<div>
				<a href="${url(controller="myprofile", action="account")}">Account Settings</a>
				<a href="${url(controller="myprofile", action="index")}">Profile</a>
				<a href="#" onclick="fbLogout();">Logout</a>
			</div>
		</div>
	</div>
%endif

