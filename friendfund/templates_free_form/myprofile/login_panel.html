<%def name="renderPanel()">
		<form id="login_panel_form" onSubmit="submitLoginPanel(this);return false;" method="POST" action="">
			<div class="inputline">
				<label for="login_email">${_("FF_LOGIN_Email Address")}</label>
				<input type="text" value="${getattr(c, "login_values", dict()).get("email")}" name="login.email" id="login_email"/>
				%if "email" in getattr(c, "login_errors", dict()):
					<p class="error">${getattr(c, "login_errors", dict()).get("email")}</p>
				%endif
			</div>
			<div class="inputline">
				<label for="login_pwd">${_("FF_LOGIN_Password")}</label>
				<input type="password" value="${getattr(c, "login_values", dict()).get("pwd")}" name="login.pwd" id="login_pwd"/>
				%if "pwd" in getattr(c, "login_errors", dict()):
					<p class="error">${getattr(c, "login_errors", dict()).get("pwd")}</p>
				%endif
			<div>
				<a onclick="xhrPost('${url(controller='myprofile', action='rppopup')}', {});closeLoginPanel();" class="lostpass">${_("FF_LOGIN_Forgot Password?")}</a></div>
			</div>
		</form>
		<a onclick="submitLoginPanel(this)" class="primarySmall floatLeft" style="margin-top:7px">${_("FF_LOGINBUTTON_Log In")}</a>
		<h3>${_("FF_LOGIN_Login with facebook or twitter")}</h3>
		<div class="inputline">
			<a title="${_("FF_LOGIN_Log in with Facebook")}" class="facebookBtn" onclick="fbLogin()">
				<span>${_("FF_LOGIN_Log in with Facebook")}</span>
			</a>
		</div><div class="inputline">
		<a title="${_("FF_LOGIN_Log in with Twitter")}" class="twitterBtn" onclick="twInit('/')">
			<span>${_("FF_LOGIN_Log in with Twitter")}</span>
		</a>
		</div>
		<p>${_("FF_LOGIN_Dont have an account yet?")} <a class="lostpass" href="/signup?furl=/">${_("FF_LOGIN_Sign up here")}</a></p>
</%def>


%if c.user.is_anon:
	<div class="newFormControls loginPanel ${not getattr(c, "expanded", False) and "hidden" or ""}" id="loginPanelContent">
		${renderPanel()|n}
	</div>
	<a class="btn" id="loginlink" onclick="toggleLoginPanel(this)">${_("FF_LOGIN_Login")}</a>
	<a href="/signup?furl=/" class="btn">${_("FF_LOGIN_Sign Up")}</a>
	
	<script type="text/javascript">
	var evts = [];
	submitLoginPanel = function(){
		xhrFormPost("${url(controller="myprofile", action="loginpanel")}", "login_panel_form", function(html){
			dojo.place(html, dojo.byId("loginPanelContent"), "only");
			var i = dojo.query("input", "loginPanelContent");
			if(i.length>0){i[0].focus()};
			});
		return false;
	};
	closeLoginPanel = function(evt){
		if(dojo.hasClass("loginlink", "active")){
			dojo.removeClass("loginlink", "active");
			dojo.addClass("loginPanelContent", "hidden");
			dojo.forEach(evts, dojo.disconnect);
		}   
	}
	toggleLoginPanel = function(link){
		if(dojo.hasClass(link, "active")){
			dojo.removeClass(link, "active");
			dojo.addClass("loginPanelContent", "hidden");
			dojo.forEach(evts, dojo.disconnect);
		} else {
			dojo.addClass(link, "active");
			dojo.removeClass("loginPanelContent", "hidden");
			evts.push(dojo.connect(document, "onkeydown", function(evt){if(evt.keyCode == 27){closeLoginPanel(evt);}else if(findParent(evt.target, "loginPanel") && evt.keyCode == 13){submitLoginPanel()}}));
			evts.push(dojo.connect(document, "onclick", function(evt){if(evt.target.id!="loginlink"&&!findParent(evt.target, "loginPanel")){closeLoginPanel(evt);}}));
		}
	}
	</script>
%else:
	<img src="${c.user.get_profile_pic()}" width="25px" height="25px" />
	<div class="showHide">
		<a href="#">${c.user.name or c.user.default_email}</a>
		<div class="widthGiver">
			<div>
				<a href="${url(controller="myprofile", action="account")}">${_("FF_LOGINDROPDOWN_Account Settings")}</a>
				<a href="${url(controller="mypools", action="stream")}">${_("FF_LOGINDROPDOWN_Profile")}</a>
				<a href="#" onclick="fbLogout();">${_("FF_LOGINDROPDOWN_Logout")}</a>
			</div>
		</div>
	</div>
%endif

