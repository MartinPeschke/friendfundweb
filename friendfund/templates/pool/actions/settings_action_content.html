
<%! 
from datetime import date, timedelta
%>
<%namespace name="forms" file="../../widgets/forms.html"/>
<%namespace name="html" file="../../widgets/html_elems.html"/>


<%def name="render(action, psettings)">
	<div  class="poolActionSubtitle">
		${action.get_display_subtitle()}
	</div>
		
	%if action.has_product_search():
		${render_product_search(action, psettings)}
	%elif action.has_payment():
		${render_payment_form(action, psettings)}
	%elif action.is_gift_vouchers():
		${render_gift_vouchers(action, psettings)}
	%else:
		<form method="POST" action="${url(controller='pool', pool_url=c.pool_url, action='action')}" id="form_${action.name}">
		<input type="hidden" name="action" value="${action.name}"/>
		
		%if action.contains_message():
			<textarea cols="60" rows="5" name="message" id="message_${action.name}">${psettings.description}</textarea>
		%endif
		%if psettings.is_expired() and action.is_extending:
			<div style="float: left;margin: 0 30px;">
				<label class="black_label" for="datestamp_${action.name}">${_("POOLSETTINGS_ACTION_LABEL_Pick an Extension Date")}</label>
				<div id="datestamp_${action.name}" jsid="datestamp_${action.name}" type="text" class="black_labeled_input datepicker" name="expiry_date" value="${psettings.get_internal_expiry_date(5)}" dojoType="dijit.form.DateTextBox" constraints="{min:'${psettings.get_internal_expiry_date(5)}'}"></div>
			</div>
		%endif
		<div style="clear:both"></div>
		<div class="submitButton">
			<a class="submitSmall" href="#" onclick="dojo.byId('form_${action.name}').submit()" id="action_submitter"><span>${_("ADMIN_ACTION_BUTTON_Submit")}</span></a>
		</div>
		</form>
	%endif
</%def>


<%def name="render_product_search(action, psettings)">
	<div id="product_search_container" style="display: block; position: relative; left: -120px;"></div>
</%def>

<%def name="render_payment_form(action, psettings)">
	<label>${_("ADMIN_ACTION_BUTTON_Go On and Contribute the missing:")} </label>
	<div class="fixedvalue">${h.format_currency(c.pool.get_amount_left(),c.pool.currency)|n}</div>
	<div class="submitButton">
		<a class="submitSmall" href="${url('chipin_fixed', pool_url=psettings.p_url, protocol=app_globals.SSL_PROTOCOL)}" id="submitter"><span>${_("CONTRIBPAGE_BUTTON_Chip in Remainder")}</span></a>
	</div>
</%def>

<%def name="render_gift_vouchers(action, psettings)">
	<label>${_("ADMIN_ACTION_BUTTON_Issue Gift Vouchers for:")}</label>
	<span class="fixedvalue">${h.format_currency(c.pool.get_total_contrib_float(), c.pool.currency)|n}</span>
	<div style="clear:both;"></div>
	<div class="submitButton">
		<a class="submitSmall" href="${url(controller="pool", pool_url=psettings.p_url, action="issue_gift_vouchers")}" id="submitter"><span>${_("ADMIN_ACTION_BUTTON_Submit")}</span></a>
	</div>
</%def>