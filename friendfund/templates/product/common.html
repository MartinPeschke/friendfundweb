<%namespace name="forms" file="../widgets/forms.html"/>
<%namespace name="html" file="../widgets/html_elems.html"/>

<%def name="display_region_picker(title)">
	<div class="region_picker underlined2">
		<span>${title|n} &nbsp;&nbsp;</span>
		<select name="region" id="region_picker" style="padding: 3px;" _base_url="${c.panel}">
			%for country_code, amazon_service in sorted(c.amazon_region_map.items()):
				<option value="${country_code}" ${forms.expression_quote(country_code==c.region, "selected")|n}>${amazon_service.domain}</option>
			%endfor
		</select>
	</div>
</%def>

<%def name="display_topsellers(top_sellers, scroller_page_size)">
	<div id="scrollingproductsuggestions" class="anythingSlider">
	<span class="arrow back arrowback anchorelem"><a>&lt;&lt;</a></span>
	<span class="arrow forward arrowforward anchorelem"><a>&gt;&gt;</a></span>
	<div dojoType="friendfund.AutoRotator" class="rotator" suspendOnHover="true" id="productslider" jsId="productsuggestionscroller1" fwdtransition="dojox.widget.rotator.panLeft" rwdtransition="dojox.widget.rotator.panRight" autoStart="true">
			<% last_prod = len(top_sellers)-1 %>
			%for i, prod in enumerate(top_sellers):
				%if i%scroller_page_size == 0:
					<div class="pane pane${i%scroller_page_size}">
				%endif
				<div _target_id="slider${i}_elem"  class="productsuggestion ${i%scroller_page_size<(scroller_page_size-1) and 'psmiddle' or ''}">
					<a class="productsuggestion">
						<img id="slider${i}_elem" src="${prod.picture}" class="productsuggestion"><span>${prod.name}</span>
					</a>
					<textarea style="display:none">
						${display_product(0, prod)|n}
						<div style="clear:both"></div>
					</textarea>
				</div>
				%if i%scroller_page_size == (scroller_page_size-1) or i==last_prod:
					</div>
				%endif
			%endfor
		</div>
	</div>
</%def>

<%def name="has_more(searchresult)">
	%if searchresult.pages > searchresult.page_no:
		<div id="product_has_more" class="paginator anchorelem" _base_url="${c.search_base_url}" 
			${h.attrib_keys(c.search_keys, [("page", searchresult.page_no+1)])|n} style="width: 437px; background-color: white; padding: 0px; height: 247px; float: left; margin: 15px auto 0pt;">
			<div style="padding: 120px 210px;">${html.ajax_loading_animation()|n}</div>
		</div>
	%endif
</%def>


<%def name="display_product_browser(searchresult, word_truncate = 200)">
%if searchresult and searchresult.items > 0:
	<div class="productSorterContainer" id="productSorterContainer">
		%for i, elem in enumerate(searchresult.products):
			${display_product(i, elem, word_truncate)}
		%endfor
		${has_more(searchresult)|n}
	</div>
%else:
	<div class="panel_content_no_margin">
	%if len(getattr(c ,"product_messages", [])) > 0:
		%for m in c.product_messages:
			<p>${m}</p>
		%endfor
	%else:
		${_("PRODUCT_SEARCH_PANEL_Nothing Really Found, search for something else?")}
	%endif
	</div>
%endif
</%def>

<%def name="display_product(counter, product, word_truncate = 200)">
	<div class="productSorter">
		<div class="colSx">
			<img class="productImage" src="${product.picture}"/>
			<img src="${c.merchant_logo_url}" alt="${request.merchant.name}" class="productMerchantImage" />
		</div>
		<div class="colDx">
			<p class="product"><span>${product.name|n}</span> <span class="currency">${h.format_currency(product.get_price_float(include_shipping = False), product.currency, extended = True)|n} ${product.display_shipping|n}</span></p>
			
			<p class="productText">${h.word_truncate_by_letters(product.description, word_truncate)|n}</p>
			
			%if product.tracking_link:
				<a href="${product.tracking_link}" target="_blank" class="productMore">${_("PRODUCT_SEARCH_PANEL_Read More")} AMAZON</a>
			%endif
			
			
		</div>
			<a class="submitSmall"><span class="anchorelem productselector" _merchant_ref="${product.merchant_ref}" _search_keys="_affnet,_imgurl,_label,_merchant_ref"
				_imgurl="${product.picture}" _label=${quoteattr(product.display_label)} _affnet="AMAZON">${_("PRODUCT_SEARCH_PANEL_Select")}</span></a>
				<div class="footer-small"></div>
				<div style="clear:both"></div>
	</div>
</%def>






