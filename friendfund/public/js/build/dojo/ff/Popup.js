/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["ff.Popup"]){dojo._hasResource["ff.Popup"]=true;dojo.provide("ff.Popup");dojo.require("ff.t");dojo.require("ff.w");dojo.require("ff.io");dojo.mixin(ff.w,{connectPopupLinks:function(_1){dojo.query(".popuplink",_1).onclick(function(_2){new ff.Popup().openFromEvent(_2);});},displayPopup:function(_3){new ff.Popup().display(_3);}});dojo.declare("ff.Popup",null,{_popup_node:null,_contentNode:null,_popup_anchor:"generic_popup",_subscriptions:[],_handler:[],afterDisplay:null,afterClose:null,constructor:function(_4){dojo.mixin(this,_4);this._popup_anchor=dojo.byId(this._popup_anchor);dojo.publish("/ff/popup/all/destroy");this._subscriptions.push(dojo.subscribe("/ff/popup/all/destroy",dojo.hitch(this,"destroy")));return this;},openFromURL:function(_5,_6){ff.io.xhrPost(_5,_6||{},dojo.hitch(this,"display"));},openFromNode:function(_7,_8){this.openFromURL(dojo.attr(_7,"_href"),_8);},openFromEvent:function(_9,_a){this.openFromNode(_9.target,_a);},destroy:function(){dojo.forEach(this._handler,dojo.disconnect);delete this._handler;dojo.forEach(this._subscriptions,dojo.unsubscribe);delete this._subscriptions;var _b=dojo.query(this._popup_node).orphan();this.afterClose&&this.afterClose(this._contentNode);delete this._contentNode;delete this._popup_node;delete _b;},esc_handler_f:function(_c){if(_c.keyCode===27){this.destroy();}},display:function(_d){var _e=this,_f=function(_10){dojo.query(".panelcloser,.popupBackground",_10).forEach(function(elt){_e._handler.push(dojo.connect(elt,"onclick",dojo.hitch(_e,"destroy")));});_e._handler.push(dojo.connect(window,"onkeyup",dojo.hitch(_e,"esc_handler_f")));var i=dojo.query("input",_10);if(i.length>0){i[0].focus();}};_e._popup_node=dojo.create("DIV",{innerHTML:_d});_e._contentNode=dojo.query(".popupContentWindow",_e._popup_node).pop();this._popup_anchor.appendChild(_e._popup_node);ff.t.centerElementInViewPort(_e._contentNode);_f(_e._popup_node);this.afterDisplay&&this.afterDisplay(_e._contentNode);return this;}});}