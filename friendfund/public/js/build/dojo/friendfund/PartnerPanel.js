/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["friendfund.PartnerPanel"]){dojo._hasResource["friendfund.PartnerPanel"]=true;dojo.provide("friendfund.PartnerPanel");dojo.declare("friendfund.PartnerPanel",null,{constructor:function(_1){var _2=this;dojo.mixin(_2,_1);_2.triedSubmitting=false;_2.target_form=dojo.isString(_2.target_form)&&dojo.byId(_2.target_form)||_2.target_form;_2.connect();_2.load_receiver();},connect:function(){var _3=this;if(dojo.byId("productSelector")){dojo.connect(dojo.byId("productSelector"),"onchange",dojo.hitch(_3,_3.swapProduct));}if(dojo.byId("occasionSelector")){dojo.connect(dojo.byId("occasionSelector"),"onchange",dojo.hitch(_3,_3.swapOccasionName));}dojo.connect(dojo.byId("occasionTyper"),"onkeyup",dojo.hitch(_3,_3.changeOccasionName));},changeOccasionName:function(_4){var _5=this;if(_4.target.value){dojo.byId(dojo.attr(_4.target,"_target")).value=_4.target.value;}else{var _6={target:dojo.byId("occasionSelector")};this.swapOccasionName(_6);}_5.check_occasion_name();},swapOccasionName:function(_7){var _8=this;var _9=_7.target.options[_7.target.selectedIndex];dojo.byId(dojo.attr(_7.target,"_name_target")).value=_9.value;dojo.byId(dojo.attr(_7.target,"_key_target")).value=dojo.attr(_9,"key");_8.check_occasion_name();},swapProduct:function(_a){var _b=_a.target.options[_a.target.selectedIndex];dojo.query(".selectedProduct","productArea").removeClass("selectedProduct").addClass("hidden");dojo.query("#product_"+dojo.attr(_b,"_guid")).addClass("selectedProduct").removeClass("hidden");},load_receiver:function(){var _c=this;_c.selector=new friendfund.CompoundFriendSelector({auth_provider:_c.auth_provider,container:_c.container,ref_node:"inviter",invited_node_suffix:"_invitees",inviter_node:"friend_list",base_url:_c.base_url,mutuals:false,global_invited_node:_c.invited_node,avail_selectors:{"facebook":true,"twitter":true,"email":true},onSelect:function(_d,_e){_c.selector.removeAll();this.inviteAppendNode(_d);dojo.addClass(_c.invited_node,"filled");_c.check_receiver();return true;},unSelect:function(_f){dojo.query("#"+_f.id,this.invited_node).orphan().forEach(dojo.hitch(this,"uninviteAppendNode"));dojo.removeClass(_c.invited_node,"filled");}});_c.selector.draw(_c.method);},submit:function(url,_10,evt){var _11=this;var _12=_11.checkCompleteness();if(!_12||_11.submitting){return false;}else{ff.t.onSubmitCleaner(_11.target_form);_11.submitting=true;return _11.auth_provider.checkLogin({level:_10,success:dojo.hitch(_11,"_submit",url),fail:function(){_11.submitting=false;}});}},_submit:function(url){var _13=this;dojo.query("input[type=submit]").attr("disabled","disabled");_13.target_form.action=url;_13.target_form.onsubmit=function(){};_13.target_form.submit();},checkCompleteness:function(){var _14=this;return _14.check_receiver()&&_14.check_occasion_name();},check_receiver:function(_15){if(dojo.query(".invitee_row","network_invitees").length!=1){dojo.query(".errorHook","receiverSelectorContainer").addClass("error");dojo.query(".errorMsgIframe","selectedReceiverContainer").removeClass("hidden");return false;}else{dojo.query(".errorHook","receiverSelectorContainer").removeClass("error");dojo.query(".errorMsgIframe","selectedReceiverContainer").addClass("hidden");return true;}},check_occasion_name:function(_16){var _17=dojo.byId("occasion_name");var _18=ff.t.findParent(_17,"generalBoxIframe");if(!_17.value){dojo.query(".errorMsgIframe",_18).removeClass("hidden");dojo.query("#yourOccasionSelector,#occasionSelectorContainer").addClass("error");return false;}else{dojo.query(".errorMsgIframe",_18).addClass("hidden");dojo.query("#yourOccasionSelector,#occasionSelectorContainer").removeClass("error");return true;}}});}