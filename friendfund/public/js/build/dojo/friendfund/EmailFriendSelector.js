/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["friendfund.EmailFriendSelector"]){dojo._hasResource["friendfund.EmailFriendSelector"]=true;dojo.provide("friendfund.EmailFriendSelector");dojo.provide("friendfund.EmailInPlaceSelector");dojo.require("ff.t");dojo.require("ff.io");dojo.declare("friendfund._Selector",null,{_listener_locals:[],_loader:"<div style=\"margin: 0px auto;text-align:center;padding:30px;\"><div class=\"loading_animation\"><img src=\"/static/imgs/ajax-loader.gif\"></div></div>",draw:function(){},destoy:function(){},uninviteAppendNode:function(_1){},inviteAppendNode:function(_2){}});dojo.declare("friendfund.EmailFriendSelector",friendfund._Selector,{_listener_locals:[],rootNode:null,constructor:function(_3){dojo.mixin(this,_3);this.ref_node=dojo.isString(this.ref_node)&&dojo.byId(this.ref_node)||this.ref_node;},draw:function(){if(this.rootNode){dojo.removeClass(this.rootNode,"hidden");dojo.query("input[type=text]",this.rootNode)[0].focus();}else{this.rootNode=dojo.create("DIV",{"id":("networkinviter_"+this.network)});dojo.byId(this.ref_node).appendChild(this.rootNode);dojo.place(this._loader,this.rootNode,"only");ff.io.xhrPost(this.base_url+"/"+this.network,{},dojo.hitch(this,"onLoad"));}},onLoad:function(_4){dojo.place(_4,this.rootNode,"only");this._listener_locals.push(dojo.connect(this.ref_node,"onclick",this,"selectClick"));this._listener_locals.push(dojo.connect(this.ref_node,"onkeydown",dojo.hitch(this,ff.t.accessability,dojo.hitch(this,"select"),function(){})));ff.w.parseDefaultsInputs(this.rootNode);dojo.query("input[type=text]",this.rootNode)[0].focus();},undraw:function(){dojo.addClass(this.rootNode,"hidden");},destroy:function(){this.rootNode=null;dojo.forEach(this._listener_locals,dojo.disconnect);this._listener_locals=[];},selectClick:function(_5){if(_5.target.id==="emailsubmitter"){this.select(_5);}},select:function(_6){var _7=dojo.byId("email_email");if(_7&&_7.value.length>0){ff.t.onSubmitCleaner(this.rootNode);ff.io.xhrFormPost(this.base_url+"/validate","emailinviter",dojo.hitch(this,"_onSelect"));}},_onSelect:function(_8){if(_8.success===true){this.onSelect(_8.html,null);dojo.place(_8.input_html,this.rootNode,"only");}else{dojo.place(_8.html,this.rootNode,"only");}var _9=dojo.query("input[type=text]",this.rootNode)[0];ff.w.parseDefaultsInputs(this.rootNode);if(_9){_9.focus();}},onSelect:function(_a,_b){this.inviteAppendNode(_a);var el=dojo.byId("invitedCounter");el.innerHTML=parseInt(el.innerHTML,10)+1;dojo.query("p.inviterTwo",this.global_invited_node).addClass("hidden");},unSelect:function(_c){dojo.query(_c).orphan();var _d=dojo.byId("invitedCounter");var _e=parseInt(_d.innerHTML,10)-1;_d.innerHTML=_e;if(_e===0){dojo.query("p.inviterTwo",this.global_invited_node).removeClass("hidden");}},inviteAppendNode:function(_f){dojo.place(_f,this.invited_node,"last");dojo.query("input[type=text]","emailinviter").attr("value","");dojo.query("#email_inviter_error","emailinviter").orphan();}});dojo.declare("friendfund.EmailInPlaceSelector",friendfund.EmailFriendSelector,{selectedValueNode:"selectedReceiver",constructor:function(_10){dojo.mixin(this,_10);this.selectedValueNode=dojo.byId(this.selectedValueNode);this.ref_node=dojo.isString(this.ref_node)&&dojo.byId(this.ref_node)||this.ref_node;},_onSelect:function(_11){var _12=this;if(_11.success===true){this.onSelect(_11.html,null);_12.selectedValueNode.value=_11.user_data;dojo.place(_11.html,this.rootNode,"only");dojo.query(".close",this.rootNode).onclick(dojo.hitch(this,"unSelect"));}else{dojo.place(_11.html,this.rootNode,"only");ff.w.parseDefaultsInputs(this.rootNode);}},onSelect:function(_13,evt){},unSelect:function(_14){this.selectedValueNode.value="";dojo.query(this.rootNode).orphan();this.destroy();this.draw();}});}