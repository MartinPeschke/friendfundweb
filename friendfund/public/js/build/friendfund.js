/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

if(!dojo._hasResource["friendfund.EmailFriendSelector"]){dojo._hasResource["friendfund.EmailFriendSelector"]=true;dojo.provide("friendfund.EmailFriendSelector");dojo.provide("friendfund.EmailInPlaceSelector");dojo.declare("friendfund._Selector",null,{_listener_locals:[],_loader:"<div style=\"margin: 0px auto;text-align:center;padding:30px;\"><div class=\"loading_animation\"><img src=\"/static/imgs/ajax-loader.gif\"></div></div>",draw:function(){},destoy:function(){},uninviteAppendNode:function(_1){},inviteAppendNode:function(_2){}});dojo.declare("friendfund.YourselfSelector",friendfund._Selector,{constructor:function(_3){dojo.mixin(this,_3);this.ref_node=dojo.isString(this.ref_node)&&dojo.byId(this.ref_node)||this.ref_node;},draw:function(){ff.io.xhrPost(this.base_url+"/validate",{"invitee.network":"yourself"},dojo.hitch(this,"_onSelect"));},_onSelect:function(_4){if(_4.success===true){this.onSelect(_4,_4.html,null);}else{dojo.place(_4.html,this.ref_node,"only");}},onSelect:function(_5,_6,_7){},undraw:function(){},destroy:function(){}});dojo.declare("friendfund.EmailFriendSelector",friendfund._Selector,{_listener_locals:[],rootNode:null,constructor:function(_8){dojo.mixin(this,_8);this.ref_node=dojo.isString(this.ref_node)&&dojo.byId(this.ref_node)||this.ref_node;},draw:function(){if(this.rootNode){dojo.removeClass(this.rootNode,"hidden");dojo.query("input[type=text]",this.rootNode)[0].focus();}else{this.rootNode=dojo.create("DIV",{"id":("networkinviter_"+this.network)});dojo.byId(this.ref_node).appendChild(this.rootNode);dojo.place(this._loader,this.rootNode,"only");ff.io.xhrPost(this.base_url+"/"+this.network,{},dojo.hitch(this,"onLoad"));}},onLoad:function(_9){dojo.place(_9,this.rootNode,"only");this._listener_locals.push(dojo.connect(this.ref_node,"onclick",this,"selectClick"));this._listener_locals.push(dojo.connect(this.ref_node,"onkeydown",dojo.hitch(this,ff.t.accessability,dojo.hitch(this,"select"),function(){})));ff.w.parseDefaultsInputs(this.rootNode);dojo.query("input[type=text]",this.rootNode)[0].focus();},undraw:function(){dojo.addClass(this.rootNode,"hidden");},destroy:function(){dojo.forEach(this._listener_locals,dojo.disconnect);this._listener_locals=[];},selectClick:function(_a){if(_a.target.id==="emailsubmitter"){this.select(_a);}},select:function(_b){var _c=dojo.byId("email_email");if(_c&&_c.value.length>0){ff.io.xhrFormPost(this.base_url+"/validate","emailinviter",dojo.hitch(this,"_onSelect"));}},_onSelect:function(_d){if(_d.success===true){this.onSelect(_d.html,null);dojo.place(_d.input_html,this.rootNode,"only");}else{dojo.place(_d.html,this.rootNode,"only");}var _e=dojo.query("input[type=text]",this.rootNode)[0];ff.w.parseDefaultsInputs(this.rootNode);if(_e){_e.focus();}},onSelect:function(_f,evt){this.inviteAppendNode(_f);var el=dojo.byId("invitedCounter");el.innerHTML=parseInt(el.innerHTML,10)+1;},unSelect:function(_10){dojo.query(_10).orphan();elem=dojo.byId("invitedCounter");elem.innerHTML=parseInt(elem.innerHTML,10)-1;},inviteAppendNode:function(_11){dojo.place(_11,this.invited_node,"last");dojo.query("input[type=text]","emailinviter").attr("value","");dojo.query("#email_inviter_error","emailinviter").orphan();},onSelect:function(_12,evt){dojo.query("p.inviterTwo",this.global_invited_node).addClass("hidden");this.inviteAppendNode(_12);var el=dojo.byId("invitedCounter");el.innerHTML=parseInt(el.innerHTML,10)+1;},unSelect:function(_13){dojo.query(_13).orphan();elem=dojo.byId("invitedCounter");elem.innerHTML=parseInt(elem.innerHTML,10)-1;}});dojo.declare("friendfund.EmailInPlaceSelector",friendfund.EmailFriendSelector,{selectedValueNode:"selectedReceiver",constructor:function(_14){dojo.mixin(this,_14);this.selectedValueNode=dojo.byId(this.selectedValueNode);this.ref_node=dojo.isString(this.ref_node)&&dojo.byId(this.ref_node)||this.ref_node;},_onSelect:function(_15){var _16=this;if(_15.success===true){this.onSelect(_15.html,null);_16.selectedValueNode.value=_15.user_data;dojo.place(_15.html,this.rootNode,"only");dojo.query(".close",this.rootNode).onclick(dojo.hitch(this,"unSelect"));}else{dojo.place(_15.html,this.rootNode,"only");}ff.w.parseDefaultsInputs(this.rootNode);},onSelect:function(_17,evt){},unSelect:function(_18){_t.selectedValueNode.value="";dojo.empty(_t.ref_node);delete _t.rootNode;_t.draw();}});}if(!dojo._hasResource["friendfund.NetworkFriendSelector"]){dojo._hasResource["friendfund.NetworkFriendSelector"]=true;dojo.provide("friendfund.NetworkFriendSelector");dojo.provide("friendfund.FriendTypeAhead");dojo.declare("friendfund.NetworkFriendPanel",friendfund._Selector,{constructor:function(_19){dojo.mixin(this,_19);},draw:function(){ff.io.xhrPost(this.base_url+"/"+this.network,{},dojo.hitch(this,"onLoad"));},onLoad:function(_1a){dojo.place(_1a.html,this.ref_node,"only");dojo.style(this.ref_node,"display","Block");},destroy:function(){dojo.forEach(this._listener_locals,dojo.disconnect);this._listener_locals=[];},select:function(evt){var _1b=ff.t.findParent(evt.target,"invitee_row");if(_1b){return this.onSelect(_1b,evt);}}});dojo.declare("friendfund.DataProvider",friendfund.NetworkFriendPanel,{_selected:{},constructor:function(_1c){dojo.mixin(this,_1c);this._rendering=false;this._current_display_idx=0;this._fully_loaded=false;this._search_index={};},addToSearchIndex:function(ud){ud["dom_id"]=this.network+"_"+ud.network_id;var s,_1d,i,j,k,tmp,_1e={};s=ud.name.split(" ").concat([ud.name]);for(i=0;i<s.length;i++){_1d=s[i];for(j=0;j<=_1d.length;j++){k=_1d.substr(0,j).toLowerCase();_1e[k]=true;}}for(k in _1e){tmp=this._search_index[k]||[];if(tmp.push){tmp.push(ud);this._search_index[k]=tmp;}}if(this.current_filter.length&&_1e[this.current_filter]){this.renderUserAndPlace(ud);}},_addPage:function(_1f,_20){var i,ud;for(i=0;i<_1f.length;i++){ud=_1f[i];this.addToSearchIndex(ud);}this._fully_loaded=_20;},renderSlice:function(_21,_22){var _23=ff.t.render,_24=this.friends_template,sel=this._selected,_25=this.mutuals,si=this._search_index[this.current_filter||""]||[],_26=[],_27=[],len=si.length,i;for(i=this._current_display_idx;i<len;i++){if(!sel[si[i].dom_id]&&(!_25||_25&&si[i].mutual_with)){_26.push(si[i]);}if(_26.length<=_21){this._current_display_idx++;}}len=_26.length>_21?_21:_26.length;for(i=0;i<len;i++){_27.push(_23(_24,_26[i]));}if(_22){_27.push("<li id=\"loading_placeholder_"+this.network+"\" class=\"floatLeft\">&nbsp;</li>");}return _27;},getFirstPage:function(){this._current_display_idx=0;return this.renderSlice(this._page_size,true);},getNextPage:function(){return this.renderSlice(this._page_size);},hasMoreFriends:function(){return !this._fully_loaded||this._current_display_idx<this._search_index[this.current_filter||""].length;},reRender:function(){var _28=this.getFirstPage();if(_28.length){dojo.place(_28.join(""),this.friendlist,"only");this.onResultsFound();}else{delete dojo.query("*",this.friendlist).orphan();this.onNoResultsFound();}},onResultsFound:function(){},onNoResultsFound:function(){},_checkScrollingState:function(evt){friendlist_loader=dojo.byId("loading_placeholder_"+this.network);if(!friendlist_loader){return;}var pos=dojo.position(friendlist_loader);if(pos.y<this.friendlist_box){if(this.hasMoreFriends()){dojo.place(this.getNextPage().join(""),friendlist_loader,"before");}}},renderUserAndPlace:function(_29){dojo.place(ff.t.render(this.friends_template,_29),this.friendlist,"last");},addLoad:function(_2a){if(_2a.friends){this._addPage(_2a.friends,_2a.is_complete);if(!_2a.is_complete){ff.io.xhrPost(this.base_url+"/ext_"+this.network,{offset:_2a.offset},dojo.hitch(this,"addLoad"));}}},draw:function(){if(this.rootNode){dojo.removeClass(this.rootNode,"hidden");this.connect();}else{if(!this.is_selected()||this._is_loading!==true){this._is_loading=true;var l=dojo.query("#networkinviter_"+this.network);if(l.length){l.orphan();}this.rootNode=dojo.create("DIV",{"id":("networkinviter_"+this.network)});dojo.byId(this.ref_node).appendChild(this.rootNode);dojo.place(this._loader,this.rootNode,"only");ff.io.xhrPost(this.base_url+"/"+this.network,{},dojo.hitch(this,"onLoad"));}}}});dojo.declare("friendfund.NetworkFriendSelector",friendfund.DataProvider,{rootNode:null,_is_loading:false,_page_size:20,current_filter:"",constructor:function(_2b){dojo.mixin(this,_2b);if(this.invited_node){this.invited_node=dojo.isString(this.invited_node)&&dojo.byId(this.invited_node)||this.invited_node;}else{this.invited_node=null;}_is_selected_decider=".methodselector.ajaxlink.selected[_type="+this.network+"]";this.lazyReRender=ff.t.debounce(dojo.hitch(this,"reRender"),200,false);this.checkScrollingState=ff.t.debounce(dojo.hitch(this,"_checkScrollingState"),100,false);},is_selected:function(){return dojo.query(this._is_selected_decider,this.container).length>0;},connect:function(){},undraw:function(){if(this.rootNode){dojo.addClass(this.rootNode,"hidden");}else{var l=dojo.query("#networkinviter_"+this.network);if(l.length){l.orphan();}}dojo.forEach(this._listener_locals,dojo.disconnect);this._listener_locals=[];},onLoad:function(_2c){var _2d=this;_2d._is_loading=false;dojo.place(_2c.html,_2d.rootNode,"only");if(_2c.success){_2d.friendlist=dojo.byId("friend_list_"+_2d.network);_2d.friendlist_box=dojo.position(_2d.friendlist.parentNode);_2d.friendlist_box=_2d.friendlist_box.h+_2d.friendlist_box.y;var _2e=dojo.byId("toggle_mutuals_"+_2d.network);if(_2e){dojo.connect(_2e,"onclick",_2d,"toggle_mutuals");_2d.mutuals=_2e.checked;}else{_2d.mutuals=false;}_2d.friends_template=_2c.template;_2d._addPage(_2c.friends,_2c.is_complete);_2d.reRender();_2d.filterNode=dojo.byId("filter_"+_2d.network);dojo.connect(_2d.friendlist,"onclick",_2d,"select");dojo.connect(_2d.filterNode,"onkeyup",_2d,"filter");ff.w.parseDefaultsInputs(_2d.ref_node);dojo.connect(_2d.friendlist.parentNode,"onscroll",this.checkScrollingState);if(!_2c.is_complete){ff.io.xhrPost(_2d.base_url+"/ext_"+_2d.network,{offset:_2c.offset},dojo.hitch(_2d,"addLoad"));}}else{dojo.query("a.facebookBtn",_2d.rootNode).forEach(function(_2f){level=parseInt(dojo.attr(_2f,"_level"),10);dojo.connect(_2f,"onclick",dojo.hitch(_2d.auth_provider,"doFBLogin",{level:level,success:dojo.hitch(_2d,"draw")}));});dojo.query("a.twitterBtn",_2d.rootNode).forEach(function(_30){level=parseInt(dojo.attr(_30,"_level"),10);dojo.connect(_30,"onclick",dojo.hitch(_2d.auth_provider,"doTWLogin",{level:level,success:dojo.hitch(_2d,"draw")}));});_2d.rootNode=null;}},onSelect:function(_31,evt){this.checkScrollingState();dojo.query("p.inviterTwo",this.global_invited_node).addClass("hidden");this.inviteAppendNode(_31);var el=dojo.byId("invitedCounter");el.innerHTML=parseInt(el.innerHTML,10)+1;},inviteAppendNode:function(_32){var _33=this;dojo.query(_32).orphan().forEach(function(_34){dojo.place(_34,_33.invited_node,"last");_33._selected[_34.id]=true;});},uninviteAppendNode:function(_35){delete this._selected[_35.id];this.lazyReRender();},unSelect:function(_36){var _37=this;dojo.query(_36).orphan().forEach(function(_38){_37.uninviteAppendNode(_38);var ctr=dojo.byId("invitedCounter");var _39=parseInt(ctr.innerHTML,10)-1;ctr.innerHTML=_39;if(_39===0){dojo.query("p.inviterTwo",_37.global_invited_node).removeClass("hidden");}});},toggle_mutuals:function(evt){this.mutuals=evt.target.checked;this.lazyReRender();},filter:function(evt){if(evt.keyCode==27){this.filterNode.value="";this.current_filter="";}else{if(evt.keyCode<45&&evt.keyCode!=8){return;}}this.current_filter=this.filterNode.value.toLowerCase();this.lazyReRender();}});dojo.declare("friendfund.FriendTypeAhead",friendfund.DataProvider,{rootNode:null,_is_loading:false,_page_size:5,current_filter:"",_has_results:false,selectedValueNode:"selectedReceiver",constructor:function(_3a){dojo.mixin(this,_3a);this._is_selected_decider=".methodselector.ajaxlink.selected[_type="+this.network+"]";this.lazyReRender=ff.t.debounce(dojo.hitch(this,"reRender"),100,false);this.mutuals=false;this.selectedValueNode=dojo.byId(this.selectedValueNode);this.checkScrollingState=ff.t.debounce(dojo.hitch(this,"_checkScrollingState"),100,false);},is_selected:function(){return dojo.query(this._is_selected_decider,this.container).length>0;},connect:function(){this._listener_locals.push(dojo.connect(this.friendlist,"onclick",this,"select"));this._listener_locals.push(dojo.connect(this.filterNode,"onkeyup",this,"filter"));this._listener_locals.push(dojo.connect(window,"onclick",this,"onHideSelector"));this._listener_locals.push(dojo.connect(this.filterNode,"onfocus",this,"onShowSelector"));this._listener_locals.push(dojo.connect(this.friendlist.parentNode,"onscroll",this.checkScrollingState));},onHideSelector:function(evt){if(!ff.t.findParent(evt.target,"typeAheadSelector")){this.hideSelector();}},hideSelector:function(){var pn=ff.t.findParent(this.friendlist,"friendsList");dojo.addClass(pn,"hidden");},onShowSelector:function(evt){evt.target.select();this.reRender();var tmp=dojo.position(this.friendlist.parentNode);this.friendlist_box=this.friendlist_box||tmp.y+tmp.h*1.5;},showSelector:function(){if(this._has_results){var pn=ff.t.findParent(this.friendlist,"friendsList");dojo.removeClass(pn,"hidden");}},undraw:function(){if(this.rootNode){dojo.addClass(this.rootNode,"hidden");}else{var l=dojo.query("#networkinviter_"+this.network);if(l.length){l.orphan();}}dojo.forEach(this._listener_locals,dojo.disconnect);this._listener_locals=[];},onLoad:function(_3b){var _3c=this;_3c._is_loading=false;dojo.place(_3b.html,_3c.rootNode,"only");if(_3b.success){_3c.friendlist=dojo.byId("friend_list_"+_3c.network);_3c.friends_template=_3b.template;_3c._addPage(_3b.friends,_3b.is_complete);_3c.filterNode=dojo.byId("filter_"+_3c.network);ff.w.parseDefaultsInputs(_3c.ref_node);_3c.connect();if(!_3b.is_complete){ff.io.xhrPost(_3c.base_url+"/ext_"+_3c.network,{offset:_3b.offset},dojo.hitch(_3c,"addLoad"));}}else{dojo.query("a.facebookBtn",_3c.rootNode).forEach(function(_3d){level=parseInt(dojo.attr(_3d,"_level"),10);dojo.connect(_3d,"onclick",dojo.hitch(_3c.auth_provider,"doFBLogin",{level:level,success:dojo.hitch(_3c,"draw")}));});dojo.query("a.twitterBtn",_3c.rootNode).forEach(function(_3e){level=parseInt(dojo.attr(_3e,"_level"),10);dojo.connect(_3e,"onclick",dojo.hitch(_3c.auth_provider,"doTWLogin",{level:level,success:dojo.hitch(_3c,"draw")}));});_3c.rootNode=null;}},onResultsFound:function(){this._has_results=true;this.showSelector();},onNoResultsFound:function(){this._has_results=false;this.hideSelector();},onSelect:function(_3f,evt){this.inviteAppendNode(_3f);},inviteAppendNode:function(_40){var _41=this;dojo.query(_40).forEach(function(_42){var pn=ff.t.findParent(_41.friendlist,"typeAheadSelector");dojo.query("img.smallProfPic",pn).orphan();dojo.query("img",_42).forEach(function(n){var _43=dojo.create("IMG",{src:n.src,className:"smallProfPic"});dojo.place(_43,pn,"first");_41.filterNode.value=dojo.query("p",_42).attr("innerHTML").join("");_41.current_filter=_41.filterNode.value.toLowerCase();dojo.addClass(_41.filterNode,"selected");_41.reRender();_41.selectedValueNode.value=dojo.query("input",_42).attr("value").join("");});});},uninviteAppendNode:function(_44){},unSelect:function(_45){},filter:function(evt){if(evt.keyCode==27){this.filterNode.value="";this.current_filter="";}else{if(evt.keyCode<45&&evt.keyCode!=8){return;}}this.current_filter=this.filterNode.value.toLowerCase();this.lazyReRender();}});}if(!dojo._hasResource["friendfund.CompoundFriendSelector"]){dojo._hasResource["friendfund.CompoundFriendSelector"]=true;dojo.provide("friendfund.CompoundFriendSelector");dojo.declare("friendfund.CompoundFriendSelector",null,{_widget_locals:[],_listener_locals:[],selectors:{},constructor:function(_46){var _47=this;dojo.mixin(_47,_46);this.networkSelector=this.networkSelector||friendfund.NetworkFriendSelector;this.emailSelector=this.emailSelector||friendfund.EmailFriendSelector;if(_46.avail_selectors.facebook===true){_47.selectors.facebook=new this.networkSelector({container:_47.container,auth_provider:_47.auth_provider,ref_node:_47.ref_node,invited_node:"network"+_47.invited_node_suffix,global_invited_node:_47.global_invited_node,base_url:_47.base_url,network:"facebook"});}if(_46.avail_selectors.twitter===true){_47.selectors.twitter=new this.networkSelector({container:_47.container,auth_provider:_47.auth_provider,ref_node:_47.ref_node,invited_node:"network"+_47.invited_node_suffix,global_invited_node:_47.global_invited_node,base_url:_47.base_url,network:"twitter"});}if(_46.avail_selectors.email===true){_47.selectors.email=new this.emailSelector({ref_node:_47.ref_node,auth_provider:_47.auth_provider,invited_node:"network"+_47.invited_node_suffix,global_invited_node:_47.global_invited_node,base_url:_47.base_url,network:"email"});}for(var sel in _47.selectors){var s=_47.selectors[sel];if(_47.selectors.hasOwnProperty(sel)&&_47.selectors[sel]){if(_47.onSelect){s.onSelect=dojo.hitch(s,_47.onSelect);}if(_47.unSelect){s.unSelect=dojo.hitch(s,_47.unSelect);}_47._widget_locals.push(s);}}if(_47.invited_node_suffix){_47._listener_locals.push(dojo.connect(dojo.byId(_47.global_invited_node),"onclick",_47,"unselect"));}var _48=dojo.byId("removeall");if(_48){_47._listener_locals.push(dojo.connect(_48,"onclick",_47,"removeAll"));}},removeAll:function(){var _49=this;dojo.query(".invitee_row.selectable",_49.global_invited_node).forEach(function(_4a){_49.selectors[dojo.attr(_4a,"_network")].unSelect(_4a);});},unselect:function(evt){var _4b=ff.t.findParent(evt.target,"invitee_row");if(!_4b||!dojo.hasClass(_4b,"selectable")){return;}this.selectors[dojo.attr(_4b,"_network")].unSelect(_4b);},destroy:function(){dojo.forEach(this._listener_locals,dojo.disconnect);this._listener_locals=[];dojo.forEach(this._widget_locals,function(_4c){_4c.destroy();});this._widget_locals=[];},switchMethod:function(evt){var _4d=this;if(dojo.hasClass(evt.target,"selected")){return;}dojo.query(".ajaxlink.selected",_4d.container).forEach(function(_4e){dojo.removeClass(_4e,"selected");var _4f=_4d.selectors[dojo.attr(_4e,"_type")];if(_4f){_4f.undraw();}});dojo.addClass(evt.target,"selected");var _50=_4d.selectors[dojo.attr(evt.target,"_type")];if(_50){_50.draw();}},draw:function(_51){var _52=this;_52.selectors[_51].draw();dojo.query(".ajaxlink",_52.container).forEach(function(_53){_52._listener_locals.push(dojo.connect(_53,"onclick",_52,"switchMethod"));});}});}if(!dojo._hasResource["friendfund.InvitePage"]){dojo._hasResource["friendfund.InvitePage"]=true;dojo.provide("friendfund.InvitePage");dojo.declare("friendfund.InvitePage",null,{selector:null,_listener_locals:[],_widget_locals:[],submitting:false,constructor:function(_54){var _55=this;dojo.mixin(_55,_54);_55.selector=new friendfund.CompoundFriendSelector({auth_provider:_55.auth_provider,container:_55.container,ref_node:"inviter",invited_node_suffix:"_invitees",inviter_node:"friend_list",base_url:_55.base_url,global_invited_node:_55.invited_node,avail_selectors:{"facebook":true,"twitter":true,"email":true}});_55._widget_locals.push(_55.selector);dojo.connect(document,"onclick",dojo.hitch(null,_55.loadPreviewPopup,_55,_55.method));},loadPreviewPopup:function(_56,_57,evt){if(dojo.hasClass(evt.target,"message_preview")){dojo.query("input.addRefContent",_56.target_form).forEach(function(_58){_58.value=dojo.byId(dojo.attr(_58,"_source")).value;});params=dojo.formToObject(_56.target_form);params.method=dojo.attr(evt.target,"_method");ff.io.xhrPost(dojo.attr(evt.target,"_href"),params);}},prepareSubmit:function(_59,_5a,evt){ff.t.onSubmitCleaner(_59.target_form);if(_59.submitting){return false;}_59.submitting=true;return _59.auth_provider.checkLogin({level:_5a,success:dojo.hitch(_59,"_submit"),fail:function(){_59.submitting=false;}});},_submit:function(){var _5b=this;dojo.forEach(_5b._widget_locals,function(_5c){_5c.destroy(_5c);});_5b._widget_locals=[];_5b.receiver_selectors={};dojo.query("input.addRefContent",_5b.target_form).forEach(function(_5d){_5d.value=dojo.byId(dojo.attr(_5d,"_source")).value;});dojo.byId(_5b.target_form).submit();}});}if(!dojo._hasResource["friendfund.PartnerPanel"]){dojo._hasResource["friendfund.PartnerPanel"]=true;dojo.provide("friendfund.PartnerPanel");dojo.declare("friendfund.PartnerPanel",null,{constructor:function(_5e){var _5f=this;dojo.mixin(_5f,_5e);_5f.triedSubmitting=false;_5f.target_form=dojo.isString(_5f.target_form)&&dojo.byId(_5f.target_form)||_5f.target_form;_5f.connect();_5f.load_receiver();},connect:function(){var _60=this;if(dojo.byId("productSelector")){dojo.connect(dojo.byId("productSelector"),"onchange",dojo.hitch(_60,_60.swapProduct));}if(dojo.byId("occasionSelector")){dojo.connect(dojo.byId("occasionSelector"),"onchange",dojo.hitch(_60,_60.swapOccasionName));}dojo.connect(dojo.byId("occasionTyper"),"onkeyup",dojo.hitch(_60,_60.changeOccasionName));},changeOccasionName:function(evt){var _61=this;if(evt.target.value){dojo.byId(dojo.attr(evt.target,"_target")).value=evt.target.value;}else{var _62={target:dojo.byId("occasionSelector")};this.swapOccasionName(_62);}_61.check_occasion_name();},swapOccasionName:function(evt){var _63=this;var _64=evt.target.options[evt.target.selectedIndex];dojo.byId(dojo.attr(evt.target,"_name_target")).value=_64.value;dojo.byId(dojo.attr(evt.target,"_key_target")).value=dojo.attr(_64,"key");_63.check_occasion_name();},swapProduct:function(evt){var _65=evt.target.options[evt.target.selectedIndex];dojo.query(".selectedProduct","productArea").removeClass("selectedProduct").addClass("hidden");dojo.query("#product_"+dojo.attr(_65,"_guid")).addClass("selectedProduct").removeClass("hidden");},load_receiver:function(){var _66=this;_66.selector=new friendfund.CompoundFriendSelector({auth_provider:_66.auth_provider,container:_66.container,ref_node:"inviter",invited_node_suffix:"_invitees",inviter_node:"friend_list",base_url:_66.base_url,mutuals:false,global_invited_node:_66.invited_node,avail_selectors:{"facebook":true,"twitter":true,"email":true},onSelect:function(_67,evt){_66.selector.removeAll();this.inviteAppendNode(_67);dojo.addClass(_66.invited_node,"filled");_66.check_receiver();return true;},unSelect:function(_68){dojo.query("#"+_68.id,this.invited_node).orphan().forEach(dojo.hitch(this,"uninviteAppendNode"));dojo.removeClass(_66.invited_node,"filled");}});_66.selector.draw(_66.method);},submit:function(url,_69,evt){var _6a=this;var _6b=_6a.checkCompleteness();if(!_6b||_6a.submitting){return false;}else{ff.t.onSubmitCleaner(_6a.target_form);_6a.submitting=true;return _6a.auth_provider.checkLogin({level:_69,success:dojo.hitch(_6a,"_submit",url),fail:function(){_6a.submitting=false;}});}},_submit:function(url){var _6c=this;dojo.query("input[type=submit]").attr("disabled","disabled");_6c.target_form.action=url;_6c.target_form.onsubmit=function(){};_6c.target_form.submit();},checkCompleteness:function(){var _6d=this;return _6d.check_receiver()&&_6d.check_occasion_name();},check_receiver:function(_6e){if(dojo.query(".invitee_row","network_invitees").length!=1){dojo.query(".errorHook","receiverSelectorContainer").addClass("error");dojo.query(".errorMsgIframe","selectedReceiverContainer").removeClass("hidden");return false;}else{dojo.query(".errorHook","receiverSelectorContainer").removeClass("error");dojo.query(".errorMsgIframe","selectedReceiverContainer").addClass("hidden");return true;}},check_occasion_name:function(_6f){var _70=dojo.byId("occasion_name");var _71=ff.t.findParent(_70,"generalBoxIframe");if(!_70.value){dojo.query(".errorMsgIframe",_71).removeClass("hidden");dojo.query("#yourOccasionSelector,#occasionSelectorContainer").addClass("error");return false;}else{dojo.query(".errorMsgIframe",_71).addClass("hidden");dojo.query("#yourOccasionSelector,#occasionSelectorContainer").removeClass("error");return true;}}});}
